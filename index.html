
<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

    <title>Mind vortex</title>
    <meta name="description" content="Welcome!" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="application/rss+xml" rel="alternate" title="Mind vortex" href="/feed.rss" />
    <link type="application/atom+xml" rel="alternate" title="Mind vortex" href="/feed.atom" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <link href="/assets/css/normalize.css" rel="stylesheet" />
    <link href="/assets/css/h5bp.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href="/assets/css/override.css" rel="stylesheet" />
    <link href="/assets/css/github.css" rel="stylesheet" type="text/css">


    <meta name="application-name" content="Mind vortex" />
    <meta name="msapplication-tooltip" content="Mind vortex" />
    <meta name="msapplication-starturl" content="/" />

    <meta property="og:title" content="Mind vortex" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.petrikvandervelde.nl/" />
    <!-- TODO: More social graph meta tags -->

    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/highlight.pack.js"></script>
    <script src="/assets/js/clean-blog.js"></script>
    <script src="/assets/js/d3.v3.min.js"></script>
    <script src="/assets/js/trianglify.min.js"></script>
    <script src="/assets/js/Please-compressed.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="/assets/js/html5shiv.js"></script>
            <script src="/assets/js/respond.min.js"></script>
    <![endif]-->

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        <div id="header" class="container">
            <div id="logo">
                <h1><a href="/">Mind vortex</a></h1>
            </div>
            <div id="menu">
                <ul>
                                <li class="active" >
                Home
            </li>
            <li class="inactive" >
                <a href="/projects">Projects</a>
            </li>
            <li class="inactive" >
                <a href="/posts">Archive</a>
            </li>
            <li class="inactive" >
                <a href="/about">About</a>
            </li>

                </ul>
            </div>
        </div>

        <div id="page" class="container">
            <div id="sidebar">
                <div id="sbox1">
                    <h2>Patrick van der Velde</h2>

<p>
    <img src="http://www.gravatar.com/avatar/9bc8b3ff385cd14f2b12138c97729df2?s=160" alt="Gravatar for Patrick van der Velde">
</p>
<p>
    Dutch software developer, living, working and playing in New Zealand.
    Rock climber, and paragliding pilot. Developer of <a href="http://pvandervelde.github.io/Sherlock)">Sherlock</a>
    <a href="http://pvandervelde.github.io/Nuclei">Nuclei</a> and other projects
</p>
<p>
    <a href="/about.html">More ...</a>
</p>

                </div>
                <div id="sbox2">
                    <h2>Recent</h2>
                    <ul class="list-unstyled">
                            <li><a href="/posts/Goals-for-2017">Goals for 2017</a></li>
                            <li><a href="/posts/Updating-blog-to-wyam">Exit Docpad, enter Wyam</a></li>
                            <li><a href="/posts/nBuildKit-release-V051">nBuildKit release - V0.5.1</a></li>
                            <li><a href="/posts/nBuildKit-release-V041">nBuildKit release - V0.4.1</a></li>
                            <li><a href="/posts/Creating-azure-vm-images-with-powershell">Creating Azure VM images with Powershell</a></li>
                            <li><a href="/posts/Building-and-delivering-nBuildKit-with-AppVeyor">Building and delivering nBuildKit with AppVeyor</a></li>
                            <li><a href="/posts/nBuildKit-release-V032">nBuildKit release - V0.3.2</a></li>
                            <li><a href="/posts/Adding-pagination-with-DocPad">Adding pagination with DocPad</a></li>
                            <li><a href="/posts/Blog-archives-by-DocPad">Blog archives by DocPad</a></li>
                            <li><a href="/posts/nBuildKit-release-V024">nBuildKit release - V0.2.4</a></li>
                    </ul>
                </div>
                <div id="sbox3">
                    <h2>Tags</h2>
                    <div>
                        <ul class="list-unstyled">
                                <li>
                                    <a role="button" href="/tags/sherlock" class="btn btn-default btn-sm"> Sherlock (13)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/pg2" class="btn btn-default btn-sm"> PG2 (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/paragliding" class="btn btn-default btn-sm"> Paragliding (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/blog" class="btn btn-default btn-sm"> Blog (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nbuildkit" class="btn btn-default btn-sm"> nBuildKit (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nuclei" class="btn btn-default btn-sm"> Nuclei (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nanicitus" class="btn btn-default btn-sm"> nAnicitus (5)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/docpad" class="btn btn-default btn-sm"> DocPad (3)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nadoni" class="btn btn-default btn-sm"> nAdoni (2)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/pdb" class="btn btn-default btn-sm"> PDB (2)</a>
                                </li>
                        </ul>
                    </div>
                    <br />
                    <ul class="pager">
                        <li class="next">
                            <a href="/tags">View All Tags &rarr;</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="content">
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/Goals-for-2017">Goals for 2017</a>
</h2>
<div id="post-meta">
    <p>
Friday, 13 January 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/goals" class="btn btn-default btn-xs">Goals</a>
                    <a id="post-category" role="button" href="/tags/life" class="btn btn-default btn-xs">Life</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>In 2016 set myself a bunch of goals for the year for different areas of my life. Of all the goals
I only managed to achieve one successfully but am still pretty happy with how the year turned
out. Overall improvements were made and new things were learned so what that concerns it was
a successful year.</p>
<p>Given that setting goals did sort of work for me in 2016 going into 2017 I decided to do this again
and set some goals in order to actively progress in different areas. This time I also decided to
write the goals down somewhere public.</p>
<p>For 2017 my goals are</p>
<ul>
<li><p>Improve my overall fitness while maintaining my weight at or below 80kg.</p>
<p>In 2016 my goal was to improve my fitness and lose some weight. Due to a shoulder and elbow injury
I actually gained weight in the first half of the year but over the course of the last 6 months
I managed to lose about 5kgs thanks to a lot of exercise and an improvement in my eating habits.
As a bonus I gained a lot of strength and general endurance. Overall these improvements have made
me feel a lot better, have a more defined set of muscles and helped me in my outdoor spot pursuits
as well.</p>
<p>For 2017 the goal is to keep the weight the same, just below 80kgs, while improving my general
strength and fitness.</p>
</li>
<li><p>Make my career independent from my job</p>
<p>The last two years I have been working for <a href="https://vista.co">Vista</a> as a software / build engineer
responsible for the development tooling and infrastructure. While this has been a bit of a change
from my previous jobs as software developer it has been a great experience. I have learned about
many new technologies, created some awesome tooling and have many more things still to learn and
create. However with this change from general developer to more of an internal tooling / infrastructure
person it has also become clear to me that my technical capabilities will improve more if I make
my toughts, opinions and code available for public scrutiny by the larger development community.
I already have a <a href="/projects">number of open source projects</a> but for 2017 I also plan to write
and potentially speak more about the things I'm working on. One part of that is re-re-activating
my blog and writing new posts about some of the cool technologies I'm currently working with and on.</p>
</li>
<li><p>Simplify life and my surroundings.</p>
<p>The first few years after I moved to New Zealand I didn't have very much in the way of material
possessions, after all I had just moved to the other side of the world with only the things I could
take on the airplane. Additionally I moved almost every year to a new house so getting rid of
useless possessions meant I had to move less stuff from the old house to the new one. Over time
though I have acquired more things both materially and in habits. Some of those things are
<a href="/tags/paragliding">highly</a> <a href="/tags/climbing">prized</a> however some things are a waste of time and
space. The goal for 2017 is to minimize the amount of useless stuff I have, like pieces of furniture
which are never used, and useless things I do so that there is  more time and space to spend on
things that are useful and improve my life.</p>
</li>
<li><p>Improve my confidence, in general in life but especially for climbing and paragliding</p>
<p>In general in life having confidence in yourself and your skills is important. For my outdoor
activities, climbing and paragliding, it is even more important. Without confidence in yourself and
your skils it is not possible to perform well in either activity. Due to injuries and some
intense experiences my confidence in either my climbing or flying skills isn't very high at the
moment so 2017 is the year that I will do my utmost best to improve my confidence in my professional
skills, my climbing and paragliding capabilities and life in general.</p>
</li>
<li><p>Sports / achievment goals</p>
<p>The final goals for 2017, at least as far as this list goes, is to actively improve my skils
in climbing and flying.</p>
<p>For a while I have been trying to improve my climbing skills, strength and endurance enough to
be able to climb a <a href="https://en.wikipedia.org/wiki/Grade_(climbing)">grade 24</a>
<a href="https://en.wikipedia.org/wiki/Sport_climbing">sports climb</a>. So for 2017 that will be my goal, to
improve enoguh to finally be able to climb a 24. Additionally over the last few years I have been
doing more <a href="https://en.wikipedia.org/wiki/Traditional_climbing">trad climbing</a> I am also going to
try to improve my skills in that area by setting myself a goal of climbing a grade 20 on trad.</p>
<p>In my other outdoor activity, paragliding, the general goals are related to the distance your
can fly <a href="https://en.wikipedia.org/wiki/Paragliding#Cross-country_flying">cross country (XC)</a>. As I
have so far not managed to get away from launch at all my goal for 2017 is to do an XC flight of
more than 5km.</p>
</li>
</ul>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/Updating-blog-to-wyam">Exit Docpad, enter Wyam</a>
</h2>
<div id="post-meta">
    <p>
Wednesday, 11 January 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/blog" class="btn btn-default btn-xs">Blog</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>After not having done anything with my blog for over a year I have returned and will once again try
to make this blogging thing happen. Part of my goals for 2017 is to start advancing my career
independent from my job. And one part of that goal is to blog about all the things I'm learning.</p>
<p>For about a year and a half <a href="http://docpad.org/">Docpad</a> has been very helpful in adding content to
my blog, however as I was trying to automate my blog more and more I came to the conclusion that
being on a Windows operating system doesn't make dealing with node and NPM any easier. So I figured
it might make sense to switch to a <a href="">static generator</a> which uses technologies that play better on
Windows. Enter <a href="https://wyam.io">Wyam</a>, a static generator written in .NET, a technology stack
I'm very familiar with.</p>
<h3>Getting started</h3>
<p>To get started with Wyam I downloaded the latest version and generated a skeleton directory structure
by running the <code>wyam.exe new --recipe Blog</code> command. Once the skeleton has been created you can
create the pages by running <code>wyam.exe -r Blog -t CleanBlog</code>, and to create and be able to view
the pages you can execute <code>wyam -r Blog -t CleanBlog -p</code>. These commands assume that you store
your blog source in the <code>input</code> directory and that the website pages should be placed in the
<code>output</code> directory. This however is where the build engineer in me started making
disapproving sounds so I changed the input and output folders by specifying the appropriate command line
parameters to make it happy again</p>
<pre><code>wyam.exe --input src --output build\site -r Blog -t CleanBlog -p
</code></pre>
<p>Good that is much more inline with the standard paths used by <a href="/projects/nbuildkit">nBuildKit</a>.
Another change that needs to be made is where Wyam stores the NuGet packages. Normally Wyam stores
those in a global location, however I strongly feel that builds should always only write to their
local workspaces, so lets redirect the packages to a folder that is local to the workspaces</p>
<pre><code>wyam.exe --input src --output build\site --use-local-packages --packages-path packages -r Blog -t CleanBlog -p
</code></pre>
<p>That command line is getting longer but we can make it shorter again by moving some of the
standard items into the <a href="https://wyam.io/docs/usage/configuration">Wyam configuration file</a>, so
I created a <code>config.wyam</code> file in the root of the workspace and added the following lines</p>
<pre><code>// Preprocessor directives
#recipe Blog
#theme CleanBlog
</code></pre>
<p>And with this the command line to generate the website and start a local webserver is</p>
<pre><code>wyam.exe --input src --output build\site --use-local-packages --packages-path packages
</code></pre>
<h3>Moving the existing content</h3>
<p>Moving the existing content from the Docpad generated site to the Wyam generated site required a bit
of work although the initial results were quite easy to achieve. I started off moving the
post files to the <code>posts</code> directory and updating all the files to be named so that Wyam is able
to extract the date and time from the file name. In order for that to work Wyam wants the file
name to follow the naming convention <code>&lt;YEAR&gt;-&lt;MONTH&gt;-&lt;DAY&gt;-&lt;TITLE&gt;.md</code>.</p>
<p>The next step was to update the front matter in the post files. Wyam would like to see the
following format:</p>
<pre><code>Title: &lt;POST_TITLE_GOES_HERE&gt;
Tags:
  - &lt;TAG_1&gt;
  - &lt;TAG_2&gt;
</code></pre>
<p>With this done Wyam can generate a website with blog posts with the correct titles and dates. This
is a good start. Next are the non-post pages, like the <a href="/">home page</a> and the <a href="/projects">project pages</a>.
These can simply be dropped in the desired directory. Wyam will automatically generate HTML pages
from any Markdown file and simply copy the other files (like the favicon etc.). Any non-blog post
pages will show up in the menu bar so for all pages that should not show up in the menu bar you can
add the <code>ShowInNavBar: false</code> entry in the page front matter like so:</p>
<pre><code>Title: My page that shouldn't show up in the NavBar
ShowInNavBar: false
---
# Content
</code></pre>
<p>Once that was done I created <a href="https://wyam.io/recipes/blog/themes">overrides</a> for</p>
<ul>
<li>The page and post footers by creating the <code>_Footer.cshml</code> and <code>_PostFooter.cshtml</code> files. The page
footer was straight forward but the post footer required some additional work to get the links
to the previous and next post to function correctly. Fortunately <a href="https://daveaglick.com/">Dave Glick</a>
was very helpful on the <a href="https://gitter.im/Wyamio/Wyam">gitter</a> page for Wyam and pointed out
that there are collections that you can iterate over to find out what the previous and
next posts are.</li>
</ul>
<script src="https://gist.github.com/pvandervelde/d2825f2c5d67ab30d15ce179ced4b30f.js"></script>
<ul>
<li>The sidebar which contains my little &lsquo;about me&rsquo; blurp.</li>
<li>The navbar which by default orders pages alphabetically and does not contain a link to the home page.
In my Docpad blog both those things are not true, so I did a bit of Razor coding and generated the
navbar items myself</li>
</ul>
<script src="https://gist.github.com/pvandervelde/7645c478ae08c94d3716ca8e8ad41c4c.js"></script>
<p>These changes got most of the pages looking pretty close to what they should be, but yet not quite
the same as it was.</p>
<h3>Tweaking</h3>
<p>If you don't have an existing layout for your blog or you don't mind changing the layout then
after the previous steps you should have a very nice looking blog that works just fine. However it
turns out I'm stuborn and specific in the way I want things to look. In this case I wanted my blog
to not look any different than the existing one does, at least for the time being. So that meant
I had to do a fair amount of tweaking.</p>
<p>The first major tweak was to get the sidebar looking like it should. This turned out to be a little
harder than I expected because it required overriding the <code>_Layout.cshtml</code> page. While this is a
bigger step than the other overrides it also meant I was able to make the pages look exactly like
I wanted and I was able to re-use my CSS files.</p>
<script src="https://gist.github.com/pvandervelde/5e3520e0f150176f529b1972fc2042a7.js"></script>
<p>One of the more tricky parts was to generate a list of the last 10 posts. Originally I was using
the list of posts, however because this is the layout page that is used for all pages it might
well be that some pages are generated before the full post list is available (say hello to the
<a href="/tags">tags</a> pages). Once again Dave Glick came through and pointed me to the <a href="https://wyam.io/recipes/blog/pipelines">RawPosts</a>
collection which is generated right at the beginning of the cycle.</p>
<p>Once the issues with the sidebar were resolved the next step was to show the last five blog posts
on the home page. By default Wyam will place excepts on the home page with a link to the actual post
in the post title. However what I wanted was the full post, excluding the comment section. Once again
the <code>RawPosts</code> collection came to the rescue which allowed me to iterate over the last five posts
and get their pre-rendered content.</p>
<script src="https://gist.github.com/pvandervelde/d0d83eb2c636a5d3b63b5bf0cce6029c.js"></script>
<p>Some additional hacking also allowed me to reuse the <code>_PostHeader.cshtml</code> file for both the posts
on the home page, for which the title links to the actual post page, and for the post page in which
the title is just a header.</p>
<script src="https://gist.github.com/pvandervelde/465c0a2399f135a25e656b0d15c1866a.js"></script>
<p>With these changes the blog looks (almost) exactly like it used to look except that it is now
being generated by <a href="https://wyam.io">Wyam</a>. All in all I have to say I'm pretty happy with the result
and with how easy it was to move from Docpad to Wyam. And as a bonus I understand much more of
how Wyam works and how my own blog is generated.</p>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/nBuildKit-release-V051">nBuildKit release - V0.5.1</a>
</h2>
<div id="post-meta">
    <p>
Saturday, 23 May 2015
 |         Posted in                     <a id="post-category" role="button" href="/tags/nbuildkit" class="btn btn-default btn-xs">nBuildKit</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>Version <a href="https://github.com/pvandervelde/nBuildKit/releases/tag/0.5.1">V0.5.1</a> of the <a href="/projects/nbuildkit.html">nBuildKit</a>
build library has been released.</p>
<p>This release adds the following features</p>
<ul>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/91">91</a>: MsBuild.Projects: Common.props should
do a more extensive search for settings.props</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/90">90</a>: MsBuild: Allow pushing symbols via
NuGet enhancement</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/89">89</a>: MsBuild: Allow assembly versioning to
be more custom defined.</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/87">87</a>: MsBuild: Rename template files to have
normal extension</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/86">86</a>: MsBuild: Rename the DirMsBuildShared,
DirMsBuildExtensions and DirMsBuildTemplates properties enhancement</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/85">85</a>: Unable to build projects which have a
mixture of target frameworks</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/83">83</a>: MsBuild: Allow PreCleanScripts and
PreCompilationScripts to define their own properties</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/82">82</a>: MsBuild: Update the Sample custom
version files to match the current version gathering capabilities</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/80">80</a>: MsBuild: Combine top-level build.msbuild,
deploy.msbuild and shared.locatenbuildkit.msbuild</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/78">78</a>: MsBuild: Automatically include NuGet
dependencies if nuspec is in same directory as project</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/72">72</a>: MsBuild: Define default directory
paths only in settings.props file</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/68">68</a>: Improve inline documentation of
settings.props file</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/66">66</a>: MsBuild: Provide initialization/installation
scripts for an empty workspace</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/55">55</a>: MsBuild: Allow assembly copyright to be
more custom defined</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/22">22</a>: MsBuild: Allow each file to have their
own base directory when creating ZIP archives</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/19">19</a>: MsBuild.Projects: Provide scripts for
Visual Basic projects</li>
</ul>
<p>And fixes the following issues:</p>
<ul>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/92">92</a>: MsBuild.Projects: GetVersion, VcsInfo and
Generate files also run when they're disabled in the settings.props file</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/88">88</a>: MsBuild.Projects: Excessive NuGet
restore of global packages</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/84">84</a>: Not compatible with ncrunch</li>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/54">54</a>: MsBuild: First space trimmed from
release note content</li>
</ul>
<p>Finally the following tasks were completed:</p>
<ul>
<li><a href="https://github.com/pvandervelde/nBuildKit/issues/7">7</a>: MsBuild: Set up tests</li>
</ul>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/nBuildKit-release-V041">nBuildKit release - V0.4.1</a>
</h2>
<div id="post-meta">
    <p>
Sunday, 30 November 2014
 |         Posted in                     <a id="post-category" role="button" href="/tags/nbuildkit" class="btn btn-default btn-xs">nBuildKit</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>Version <a href="https://github.com/pvandervelde/nBuildKit/releases/tag/0.4.1">V0.4.1</a> of the
<a href="/projects/nbuildkit.html">nBuildKit</a> build library has been released.</p>
<p>This release introduces the ability to <a href="https://github.com/pvandervelde/nBuildKit/issues/44">mix custom build steps</a>
with the default provided ones in <a href="https://github.com/pvandervelde/nBuildKit/issues/47">any order</a>
that is desired. On top of that additional changes were made that now make it possible to build
<a href="https://github.com/pvandervelde/nBuildKit/issues/46">multiple Visual Studio solutions</a> in a specific
order.</p>
<p>Finally the user can provide one or more scripts that will be called if the build or the deploy process
<a href="https://github.com/pvandervelde/nBuildKit/issues/48">fails</a>. These scripts can be used to clean-up
resources or provide notification on build failure. Do note that any failure in these scripts will
lead to the immediate termination of the process.</p>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/Creating-azure-vm-images-with-powershell">Creating Azure VM images with Powershell</a>
</h2>
<div id="post-meta">
    <p>
Monday, 10 November 2014
 |         Posted in                     <a id="post-category" role="button" href="/tags/azure" class="btn btn-default btn-xs">Azure</a>
                    <a id="post-category" role="button" href="/tags/powershell" class="btn btn-default btn-xs">Powershell</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>As part of a new <a href="https://github.com/pvandervelde/azure-jenkins">project</a> to create a
<a href="http://jenkins-ci.org/">Jenkins CI server</a> on Azure I am writing a set of powershell scripts to
control virtual machines on Azure. For this project the plan is to use virtual machine (VM) images
as a template for an <a href="http://martinfowler.com/bliki/ImmutableServer.html">&lsquo;immutable server&rsquo;</a> that
will contain the Jenkins instance.</p>
<p>Now the actual server isn't really &lsquo;immutable&rsquo; given that the jenkins instance will update, add and
delete files on the hard drive which will obviously change the state of the server. As such the immutable
idea isn't applied to the whole server but more to the configuration part of the server. The idea being
that the configuration of the server will not be changed once the server is put in production. Any
configuration changes (e.g. a new version of Jenkins) will be done by creating a new image, spinning
up a new server based on that image and then destroying the old server and replacing it with the
new one.</p>
<p>So in order to achieve this goal the first step will be to build an image with all the required
software on it and then verify that this image has indeed been created correctly.</p>
<p>To create the image we first obtain a certificate that can be used for the WinRM SSL connection between
the Azure VM and the local machine that is executing the creation scripts. You can either get an official
one or you can use a self-signed certificate (which is obviously less secure). Two things of
interest are:</p>
<ul>
<li>The certificate needs to have an <a href="http://consultingblogs.emc.com/gracemollison/archive/2010/02/19/creating-and-using-self-signed-certificates-for-use-with-azure-service-management-api.aspx">exportable</a>
private key because otherwise it cannot be used for the WinRM connection.</li>
<li>The certificate needs to be named after the connection that you expect to make. For a connection to
an Azure VM this will most likely be something like <code>&lt;RESOURCE_GROUP_NAME&gt;.cloudapp.net</code>.</li>
</ul>
<p>Once the certificate is installed in the user certificate store we can create a new virtual machine
from a given base image, e.g. a Windows 2012 R2 server image. The following powershell function creates
a new windows VM with a WinRM endpoint with the certificate that was created earlier. Note that the
<a href="http://msdn.microsoft.com/en-us/library/dn495254.aspx"><code>New-AzureVM</code></a> function can create resource
and storage groups for the new VM if you don't specify a storage account and a matching resource group.</p>
<script src="https://gist.github.com/pvandervelde/1153f249115780ed2b99.js"></script>
<p>Once the VM is running a new Powershell remote session can be opened to the machine in order to start
the configuration of the machine. Note that this approach only seems to be working for <code>https</code> connections
because the <code>Get-AzureWinRMUri</code> function only returns the <code>https</code> URI. Hence the need for a certificate
that can be used to secure the connection.</p>
<script src="https://gist.github.com/pvandervelde/eb6e28934d5fd16fe186.js"></script>
<p>The next step is to copy all the installer files and configuration scripts to the VM. This can be
done over the <a href="http://measureofchaos.wordpress.com/2012/09/26/copying-files-via-powershell-remoting-channel/">remoting channnel</a>.</p>
<script src="https://gist.github.com/pvandervelde/b2f5b4156e5efe67f495.js"></script>
<p>Once all the required files have been copied to the VM the configuration of the machine can be started.
This can be done in many different ways, e.g through the use of a <a href="https://www.getchef.com/">configuration</a>
<a href="http://puppetlabs.com/">management</a> <a href="http://technet.microsoft.com/en-us/library/dn249912.aspx">tool</a>
or just via the use of plain old scripts. When the configuration is complete and all the necessary
clean-up has been done the time has come to turn the VM into an image. Before doing that a Windows
machine will have to be <a href="http://en.wikipedia.org/wiki/Sysprep">sysprepp'ed</a> so that there are no
unique identifiers in the image (and thus in the copies).</p>
<p>In order to sysprep an Azure VM it is necessary to execute the sysprep command through a script on the
VM because sysprep <a href="http://blogs.msdn.com/b/brocode/archive/2014/06/20/how-to-automate-sysprep-of-an-iaas-vm-on-microsoft-azure.aspx">fails</a>
if the command is given directly through the remoting channel. The following function creates a new
Powershell script which invokes sysprep, copies that to the VM and then executes that script. Once
sysprep has completed running the machine will be turned off and an image can be created.</p>
<script src="https://gist.github.com/pvandervelde/b2f5b4156e5efe67f495.js"></script>
<p>The next step is to test the new image in order to verify that all configuration changes have been
applied correctly. The explanation of how the testing of an virtual machine image works is a topic
for the next blog post.</p>

                </div>
            </div>
        </div>
            </div>
        </div>

        <footer>
            <div id="footer" class="container">
    <div id="fbox1">
        <h2>Related</h2>
        <ul>
            <li id="first"><a href="https://plus.google.com/+PatrickvanderVelde/about"><i class="fa fa-google-plus"></i> Google+</a></li>
            <li><a href="https://github.com/pvandervelde"><i class="fa fa-github"></i> GitHub</a></li>
            <li><a href="http://www.linkedin.com/profile/view?id=33950311"><i class="fa fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="http://stackoverflow.com/users/539846/petrik"><i class="fa fa-stack-overflow"></i> StackOverflow</a></li>
            <li><a href="http://careers.stackoverflow.com/pvandervelde"><i class="fa fa-stack-overflow"></i> StackOverflow Careers</a></li>
            <li><a href="https://twitter.com/petrikvdvelde"><i class="fa fa-twitter"></i> Twitter</a></li>
        </ul>
    </div>
    <div id="fbox2">
        <h2 id="copyright">Copyright</h2>
        <p>Copyright (c) 2017 <a href="/">Petrik van der Velde</a>. All rights reserved.</p>

        <h2 id="disclaimer">Disclaimer</h2>
        <p>The opinions expressed herein are my own personal opinions and do not represent my employer's view in any way.</p>
    </div>
    <div id="fbox3">
        <h2 id="media">Media</h2>
        <p><a href="/feed.atom"><img src="/assets/images/feed.png" alt="Atom feed"></a></p>
    </div>
</div>
<div id="copyright" class="container">
    <p>
        Site design based on the <a href="http://www.freecsstemplates.org/previews/opentools/">Open Tools</a> design
        by <a href="http://www.freecsstemplates.org">FreeCSSTemplates.org</a>.
    </p>
    <p>
        Feed icon by <a href="http://www.icojam.com/">Icojam</a> and Favicon by
        <a href="http://www.flaticon.com/free-icon/twister-sky-wind_12318" title="Yannick">Yannick</a>
        from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>
    </p>
    <p>Generated by <a href="https://wyam.io" rel="nofollow">Wyam</a> on Sat, 14 Jan 2017 11:07:59 GMT.</p>
</div>

        </footer>
    </body>
</html>

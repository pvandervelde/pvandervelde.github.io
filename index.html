<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head> 
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width" />

    <!-- Site Properities -->
    <title>Home | Mind Vortex</title>
    <meta name="description" content="The place where I ramble on about software development, fluid dynamics, flying and climbing." />
    <meta name="keywords" content="Patrick van der Velde, Petrik, Nuclei, Sherlock, nAnicitus, nAdoni, nTreva, rock climbing, paragliding" />
    <meta name="author" content="Petrik van der Velde" />

    <!-- DocPad Meta -->
    <meta name="generator" content="DocPad v6.65.0" />

    <!-- DocPad Styles + Our Own -->
    <style >html.wait {
	cursor: wait !important;
	opacity: 0;
	transition: opacity 0.5s ease;
}</style><link  rel="stylesheet" href="/vendor/normalize.css" /><link  rel="stylesheet" href="/vendor/h5bp.css" /><link  rel="stylesheet" href="/styles/style.css" /><link  rel="stylesheet" href="/styles/github.css" />

    <!-- Icons -->
    <!-- Favicon -->
    <link rel="shortcut icon" href="/icons/twister.ico" />
    
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
</head>
<body>
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
    <![endif]-->
    
    <div id="header" class="container">
        <div id="logo">
            <h1><a href="/">Mind Vortex</a></h1>
        </div>
        <div id="menu">
            <ul>
                
                    <li class="active">
                        
                            Home
                        
                    </li>
                
                    <li class="inactive">
                        
                            <a href="/projects.html">Projects</a>
                        
                    </li>
                
                    <li class="inactive">
                        
                            <a href="/archives.html">Archives</a>
                        
                    </li>
                
                    <li class="inactive">
                        
                            <a href="/about.html">About</a>
                        
                    </li>
                
            </ul>
        </div>
    </div>
    <div id="page" class="container">
        <div id="sidebar">
            <div id="sbox1">
                <h2 id="patrick-van-der-velde">Patrick van der Velde</h2>
<p><img src="http://www.gravatar.com/avatar/9bc8b3ff385cd14f2b12138c97729df2?s=160" alt="Gravatar for Patrick van der Velde"> </p>
<p>Dutch software developer, living, working and playing in New Zealand. 
Rock climber, and future paragliding pilot. Developer of <a href="http://pvandervelde.github.io/Sherlock">Sherlock</a>, 
<a href="http://pvandervelde.github.io/Nuclei">Nuclei</a> and other projects</p>
<p><a href="/about.html">More ...</a></p>

            </div>
            <div id="sbox2">
                <h2>Recent</h2>
                <ul>
                    
                        <li><a href="/posts/2014-05-28_Nuclei-release-V080.html">Nuclei release - V0.8.0</a></li>
                    
                        <li><a href="/posts/2014-05-23_Improvements-to-the-site.html">Improvements to the site</a></li>
                    
                        <li><a href="/projects/nanicitus.html">nAnicitus</a></li>
                    
                        <li><a href="/projects/nuclei.html">Nuclei</a></li>
                    
                        <li><a href="/projects/ntreva.html">nTreva</a></li>
                    
                        <li><a href="/projects/nrefs.html">nRefs</a></li>
                    
                        <li><a href="/projects/sherlock.html">Sherlock</a></li>
                    
                        <li><a href="/projects/nadoni.html">nAdoni</a></li>
                    
                        <li><a href="/posts/2014-05-19_Embedding-symbol-stream-in-pdb.html">Embedding a symbol stream in a PDB file</a></li>
                    
                        <li><a href="/posts/2014-04-30_nAnicitus-Release-V015.html">nAnicitus release - V0.1.5</a></li>
                    
                </ul>
            </div>
            <div id="sbox3">
                <h2>Tags</h2>
                
                    <a href="/tags/apollo.html" style="font-size: 120.81448319328996%">
                        Apollo
                    </a>
                
                    <a href="/tags/blog.html" style="font-size: 130.49266672559813%">
                        Blog
                    </a>
                
                    <a href="/tags/climbing.html" style="font-size: 100%">
                        Climbing
                    </a>
                
                    <a href="/tags/console.html" style="font-size: 100%">
                        Console
                    </a>
                
                    <a href="/tags/docpad.html" style="font-size: 120.81448319328996%">
                        DocPad
                    </a>
                
                    <a href="/tags/github.html" style="font-size: 100%">
                        GitHub
                    </a>
                
                    <a href="/tags/jenkins.html" style="font-size: 100%">
                        Jenkins
                    </a>
                
                    <a href="/tags/msbuild.html" style="font-size: 100%">
                        MsBuild
                    </a>
                
                    <a href="/tags/nuclei.html" style="font-size: 150%">
                        Nuclei
                    </a>
                
                    <a href="/tags/pdb.html" style="font-size: 113.13247675185968%">
                        PDB
                    </a>
                
                    <a href="/tags/pg2.html" style="font-size: 141.62896638657992%">
                        PG2
                    </a>
                
                    <a href="/tags/paragliding.html" style="font-size: 136.86752324814032%">
                        Paragliding
                    </a>
                
                    <a href="/tags/regression-test.html" style="font-size: 100%">
                        Regression test
                    </a>
                
                    <a href="/tags/regression-testing.html" style="font-size: 113.13247675185968%">
                        Regression testing
                    </a>
                
                    <a href="/tags/srcsrv.html" style="font-size: 100%">
                        SRCSRV
                    </a>
                
                    <a href="/tags/scripting.html" style="font-size: 100%">
                        Scripting
                    </a>
                
                    <a href="/tags/sherlock.html" style="font-size: 148.59593857014607%">
                        Sherlock
                    </a>
                
                    <a href="/tags/source-server.html" style="font-size: 100%">
                        Source server
                    </a>
                
                    <a href="/tags/symstore.html" style="font-size: 100%">
                        SymStore
                    </a>
                
                    <a href="/tags/symbol-server.html" style="font-size: 100%">
                        Symbol server
                    </a>
                
                    <a href="/tags/symbol-stream.html" style="font-size: 100%">
                        Symbol stream
                    </a>
                
                    <a href="/tags/teamcity.html" style="font-size: 100%">
                        TeamCity
                    </a>
                
                    <a href="/tags/teststack-white.html" style="font-size: 100%">
                        TestStack.White
                    </a>
                
                    <a href="/tags/ui-test.html" style="font-size: 100%">
                        UI test
                    </a>
                
                    <a href="/tags/unc.html" style="font-size: 100%">
                        UNC
                    </a>
                
                    <a href="/tags/wcf.html" style="font-size: 126.26495350371935%">
                        WCF
                    </a>
                
                    <a href="/tags/waipapa.html" style="font-size: 100%">
                        Waipapa
                    </a>
                
                    <a href="/tags/writing.html" style="font-size: 100%">
                        Writing
                    </a>
                
                    <a href="/tags/nadoni.html" style="font-size: 113.13247675185968%">
                        nAdoni
                    </a>
                
                    <a href="/tags/nanicitus.html" style="font-size: 130.49266672559813%">
                        nAnicitus
                    </a>
                
                    <a href="/tags/nrefs.html" style="font-size: 100%">
                        nRefs
                    </a>
                
            </div>
        </div>
        <div id="content">
            
    <div id="post-spacer">
    <div id="post">
    <div id="post-header">
        <h2>
            
                <a href='/posts/2014-05-28_Nuclei-release-V080.html'>Nuclei release - V0.8.0</a>
            
        </h2>
        <div id="post-meta">
            <p>
                Wednesday, May 28, 2014 | Posted in
                
                    <a id="post-category" href="/tags/nuclei.html">Nuclei</a>
                
            </p>
        </div>
    </div>
    <div id="post-content">
        <p>Version <a href="https://github.com/pvandervelde/Nuclei/releases/tag/0.8.0">V0.8.0</a> of the <a href="/projects/nuclei.html">Nuclei</a> library has been released. </p>
<p>This release introduces a few large features to Nuclei.Communication library and adds some minor updates to the base Nuclei library.</p>
<p>The main focus of this release was adding version tolerance (<a href="https://github.com/pvandervelde/Nuclei/issues/3">#3</a>) to the different layers of the communication stack:</p>
<ul>
<li><em>The discovery layer</em> - Provides ways to discover remote endpoints either automatically (via <a href="http://msdn.microsoft.com/en-us/library/dd456782%28v=vs.110%29.aspx">WCF discovery</a>) or manually.</li>
<li><em>The protocol layer</em> - Provides the means to send messages to one or more remote endpoints and handling the responses to those messages if they are expected.</li>
<li><em>The interaction layer</em> -  Provides an abstraction over the <em>protocol layer</em> in the form of an proxy objects that provide user-defined methods which can be invoked on a remote endpoint.</li>
</ul>
<p>In version 0.8.0 of the Nuclei.Communication library each of these layers now supports the ability to negotiate with a remote endpoint to determine which communication version will be used to exchange data between the endpoints. The  communication version which will be used is the highest (i.e. most recent) version that both endpoints support. If the endpoint do not support the same versions then communication will not be enabled between the endpoints.</p>
<p>The second focus was to improve the robustness of all the network activity. The main changes here were: </p>
<ul>
<li><a href="https://github.com/pvandervelde/Nuclei/issues/7">#7</a> - Detection of messages that have not received their response within a given time-out.</li>
<li><a href="https://github.com/pvandervelde/Nuclei/issues/11">#11</a>, <a href="https://github.com/pvandervelde/Nuclei/pull/17">#17</a>, <a href="https://github.com/pvandervelde/Nuclei/pull/18">#18</a> - Method(s) to detect if a remote endpoint is still available and discard endpoint information if it is not.</li>
<li><a href="https://github.com/pvandervelde/Nuclei/issues/19">#19</a>, <a href="https://github.com/pvandervelde/Nuclei/issues/23">#23</a> - Automatically rebuilding the communication channel if it faults during message sending and then resend the message that caused the faulting.</li>
</ul>
<p>The final focus was on decoupling the interaction interfaces from their implementations. With these changes an endpoint does not need to provide concrete implementations of either the command (<a href="https://github.com/pvandervelde/Nuclei/pull/6">#6</a>) and notification (<a href="https://github.com/pvandervelde/Nuclei/pull/31">#31</a>) interfaces but can map the members on those interfaces to equivalent members on any given object.</p>
<p>Additionally it is now possible for some parameters on a command interface method (ie. the method on a command interface) and a command object method (i.e .the concrete instance method that is mapped to the given command) to contain parameters that have a special meaning. The available options are:</p>
<ul>
<li>For command interface methods (<a href="https://github.com/pvandervelde/Nuclei/issues/23">#23</a>)<ul>
<li>Provision of a time-out indicating the maximum amount of time the endpoint should wait for a response to the command invocation request.</li>
<li>Provision of a retry count indicating the maximum number of times the endpoint should send the command invocation request should any errors occur during invocation.</li>
</ul>
</li>
<li>For command instance methods (<a href="https://github.com/pvandervelde/Nuclei/pull/28">#28</a>)<ul>
<li>Provision of the ID of the endpoint requesting the invocation of the command method.</li>
<li>Provision of the ID of the message that was send to request the invocation of the command method.</li>
</ul>
</li>
</ul>
<p>Finally the Nuclei library versioning was switched to use <a href="http://semver.org/">semantic versioning</a>.</p>
 
    </div>
</div>
    </div>

    <div id="post-spacer">
    <div id="post">
    <div id="post-header">
        <h2>
            
                <a href='/posts/2014-05-23_Improvements-to-the-site.html'>Improvements to the site</a>
            
        </h2>
        <div id="post-meta">
            <p>
                Friday, May 23, 2014 | Posted in
                
                    <a id="post-category" href="/tags/blog.html">Blog</a>
                
            </p>
        </div>
    </div>
    <div id="post-content">
        <p>Over the last few days some changes were made to the structure of this website. Of these changes the first change that was made is in the move from the standard GitHub pages URL to my own custom domain provided by the amazingly helpful people at <a href="https://dnsimple.com/">dnsimple</a>. While the URL for this website has changed it is still being hosted by GitHub pages and so the old URL will continue working just fine.</p>
<p>The only slight catch is that the project pages for my projects now suddenly redirect through my new domain as well. Apparently this is due to the way GitHub <a href="https://help.github.com/articles/setting-up-a-custom-domain-with-github-pages#overview">handles</a> custom domains. For now I will live with this situation but later on my personal projects may be moved to separate <a href="https://help.github.com/articles/what-s-the-difference-between-user-and-organization-accounts">organisations</a>.</p>
<p>The second change is the addition of pagination for the landing page. As I continued to write more blog posts this page was getting rather long and slow to load. The new landing page only contains the last five blog posts and provides a way to navigate to the previous posts at the bottom of the page. This should make the page much quicker to load. I will share the implementation of the pagination in a future blog post but for those who are interested the changes necessary to implement pagination in <a href="https://github.com/docpad/docpad-plugin-paged/">DocPad</a> are pretty minor and can be seen in a single <a href="https://github.com/pvandervelde/mindvortex/commit/9472ad503725eb42d98e30b6c4452d2b6766b344">commit</a>.</p>
<p>Besides setting up the pagination of the landing page I also created an <a href="/archive.html">archive</a> page which, logically, shows all the blog posts in chronological order. Again a future blog post will describe the necessary changes to include the archive page. </p>
<p>Last but not least the site has gotten a new <a href="http://en.wikipedia.org/wiki/Favicon">favicon</a> which is a little more vortex-y than the last icon.</p>
 
    </div>
</div>
    </div>

    <div id="post-spacer">
    <div id="post">
    <div id="post-header">
        <h2>
            
                <a href='/posts/2014-05-19_Embedding-symbol-stream-in-pdb.html'>Embedding a symbol stream in a PDB file</a>
            
        </h2>
        <div id="post-meta">
            <p>
                Monday, May 19, 2014 | Posted in
                
                    <a id="post-category" href="/tags/source-server.html">Source server</a>
                
                    <a id="post-category" href="/tags/pdb.html">PDB</a>
                
                    <a id="post-category" href="/tags/symbol-stream.html">Symbol stream</a>
                
                    <a id="post-category" href="/tags/srcsrv.html">SRCSRV</a>
                
                    <a id="post-category" href="/tags/nanicitus.html">nAnicitus</a>
                
                    <a id="post-category" href="/tags/unc.html">UNC</a>
                
            </p>
        </div>
    </div>
    <div id="post-content">
        <p>The <a href="/projects/nanicitus.html">nAnicitus</a> application processes <a href="http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-symbol-package">NuGet symbol</a> packages to push the symbols and sources up to their respective location for the symbol and source servers to work. In order to have a symbol server nothing special needs to be done, just push the symbols through the <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff558848(v=vs.85).aspx">SymStore</a> application and a nice directory with indexed symbols is created. However in order to allow debuggers to obtain the source files related to a given PDB some manipulation of the PDB files is necessary. Specifically the SRCSRV stream in the PDB file needs to be <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff552219%28v=vs.85%29.aspx">modified</a>.</p>
<p>The documentation gives a decent overview of how the source indexing works but it does not actually provide the information necessary to determine what should be written to the SRCSRV stream for a given PDB file. In fact if you want to know what information should be written to the SRCSRV stream if you want to store the indexed source files in a directory instead of getting them from your source control system then even the almighty <a href="https://www.google.co.nz/webhp?tab=ww&amp;ei=FwljU6S7J8byoATTxoLIAQ&amp;ved=0CBMQ1S4#q=PDB+SRCSRV+UNC+VERSION%3D2">google</a> is rather quiet.   </p>
<p>In order to write to the SRCSRV stream one can use the <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff558874%28v=vs.85%29.aspx">PDBStr utility</a>. However that still leaves the question of what to write to the stream. The <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms680641%28v=vs.85%29.aspx">source server documentation</a> provides examples for <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff551958%28v=vs.85%29.aspx">VERSION 1</a> streams, i.e. the kind that point the debugger to a source control (VCS) command. If however you want to store symbols and sources in a UNC path then you need <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff551966%28v=vs.85%29.aspx">VERSION 2</a> streams. With some help from this <a href="http://www.jayway.com/2011/06/19/hosting-your-own-source-symbol-server/">blog post</a>, some digging at MSDN and lots of trial-and-error it seems that the SRCSRV stream should look like:  </p>
<pre class="highlight"><code class="hljs makefile">SRCSRV: ini ------------------------------------------------
<span class="hljs-constant">VERSION</span>=2
<span class="hljs-constant">INDEXVERSION</span>=2
<span class="hljs-constant">VERCTRL</span>=http
SRCSRV: variables ------------------------------------------
<span class="hljs-constant">SRCSRVVERCTRL</span>=http
<span class="hljs-constant">UNCROOT</span>= &lt;UNC_SOURCE_PATH&gt;
<span class="hljs-constant">HTTP_EXTRACT_TARGET</span>=%UNCROOT%\\ + &lt;UNC_SOURCE_PATH&gt;
<span class="hljs-constant">SRCSRVTRG</span>=%http_extract_target%
<span class="hljs-constant">SRCSRVCMD</span>=
SRCSRV: source files ---------------------------------------
</code></pre><p>In this stream the <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff551958%28v=vs.85%29.aspx">variables mean</a>:</p>
<ul>
<li><strong><code>Version = 2</code></strong> - Indicates the version of the SRCSRV stream</li>
<li><strong><code>VerCtrl = http</code></strong> - &#39;Version control&#39; is done through HTTP. This variable is potentially optional.</li>
<li><strong><code>SRCSRVVERCTRL = http</code></strong> - Specifies the VCS in use. In this case that&#39;s UNC, potentially over http.</li>
<li><strong><code>UNCROOT</code></strong> - &#39;Local variable&#39; indicating what the UNC root path is.</li>
<li><strong><code>HTTP_EXTRACT_TARGET</code></strong> - &#39;Local variable&#39; indicating how to determine the path of a source file on the server given it&#39;s embedded path and SRCSRV information.</li>
<li><strong><code>SRCSRVTG</code></strong> - The template used by the debugger to determine the path of the source files based on their embedded path and SRCSRV information.</li>
<li><strong><code>SRCSRVCMD</code></strong> - The command for the VCS to extract the source files. For UNC this is not required.</li>
</ul>
<p>When nAnicitus processes a PDB file it generates a SRCSRV file that looks similar to this:</p>
<pre class="highlight"><code class="hljs mel">SRCSRV: ini ------------------------------------------------
VERSION=<span class="hljs-number">2</span>
INDEXVERSION=<span class="hljs-number">2</span>
VERCTRL=http
SRCSRV: variables ------------------------------------------
SRCSRVVERCTRL=http
UNCROOT=\\MyServer\sources
HTTP_EXTRACT_TARGET=<span class="hljs-variable">%UNCROOT</span><span class="hljs-variable">%\</span><span class="hljs-variable">%var2</span><span class="hljs-variable">%\</span><span class="hljs-variable">%var3</span><span class="hljs-variable">%\</span><span class="hljs-variable">%var4</span>%
SRCSRVTRG=<span class="hljs-variable">%http_extract_target</span>%
SRCSRVCMD=
SRCSRV: <span class="hljs-keyword">source</span> files ---------------------------------------
c:\<span class="hljs-keyword">source</span>\MyProject\MyClass.cs<span class="hljs-variable">*MyProject</span><span class="hljs-variable">*1</span><span class="hljs-number">.2</span><span class="hljs-number">.3</span><span class="hljs-number">.4</span><span class="hljs-variable">*MyProject</span>\MyClass.cs
SRCSRV: end------------------------------------------------
</code></pre><p>The redirection of the source paths is handled as <code>&lt;FILE&gt;*&lt;PROJECT&gt;*&lt;VERSION&gt;*&lt;RELATIVE_FILE&gt;</code> which means that the <code>c:\source\MyProject\MyClass.cs</code> file will be found on the source server at <code>\\MyServer\sources\MyProject\1.2.3.4\MyProject\MyClass.cs</code></p>
<p>The process of pushing the symbols and sources up to their respective locations with nAnicitus is done via the following steps:</p>
<ol>
<li>The user drops the NuGet symbol package containing the binaries, PDB files and source files into the designated upload folder for nAnicitus.</li>
<li>nAnicitus detects the new NuGet package and pushes the file path onto the queue for processing by the indexing thread.</li>
<li>The indexing thread pulls the file path from the queue and unzips the NuGet symbol package in a temporary location.</li>
<li>For each PDB the source paths are extracted from the PDB with <code>scrtool.exe</code>.</li>
<li>For each source path the matching source file is located by looking at all source files and seeing source file path matches the &#39;best&#39;, i.e. using the longest common substring approach, starting from the end of the path in order to ensure a match on the file name.</li>
<li>Once the source file is located the relative file path for the source file on the source server is calculated.</li>
<li>Once all the source files from the PDB are processed the SRCSRV stream file is created and embedded into the PDB with <code>pdbstr.exe</code>.</li>
<li>Once all PDBs have been indexed they are pushed through the <code>symstore.exe</code> tool to the symbol server.</li>
<li>The source files are copied to the desired directory on the source server.</li>
<li>Finally the original NuGet symbol package is moved to the directory containing all the processed symbol packages. </li>
</ol>
<p>Note that the path to the source server directory is embedded in the PDB. If the location of the source server changes then the information in the PDB files will no longer be correct. While there is a way to redirect the embedded paths nAnicitus also stores the processed NuGet symbol packages in a designated directory. This makes it possible to re-process the packages should the need ever arise.</p>
 
    </div>
</div>
    </div>

    <div id="post-spacer">
    <div id="post">
    <div id="post-header">
        <h2>
            
                <a href='/posts/2014-04-30_nAnicitus-Release-V015.html'>nAnicitus release - V0.1.5</a>
            
        </h2>
        <div id="post-meta">
            <p>
                Wednesday, April 30, 2014 | Posted in
                
                    <a id="post-category" href="/tags/nanicitus.html">nAnicitus</a>
                
            </p>
        </div>
    </div>
    <div id="post-content">
        <p>Version <a href="https://github.com/pvandervelde/nAnicitus/releases/tag/0.1.5">V0.1.5</a> of the <a href="/projects/nanicitus.html">nAnicitus</a> symbol store application has been released.  </p>
<p>This release fixes the following issues:</p>
<ul>
<li><a href="https://github.com/pvandervelde/nAnicitus/issues/4">#4</a> - Switch versioning scheme to use Semantic Versioning. The version is automatically calculated from the previous version tags in the repository with the <a href="https://github.com/JakeGinnivan/GitHubFlowVersion">GitHubFlowVersion</a> tool.</li>
<li><a href="https://github.com/pvandervelde/nAnicitus/issues/6">#6</a> - Mark all files as read-only. All source files which are copied to the the UNC directory are now marked as read-only so that users won&#39;t be able to change them.</li>
<li><a href="https://github.com/pvandervelde/nAnicitus/issues/7">#7</a> - Srctool last message not stripped when finding source paths in PDB</li>
<li><a href="https://github.com/pvandervelde/nAnicitus/issues/8">#8</a> - PDB embedded sourceserver file path calculation doesn&#39;t match server path. The source server file path is now calculated for each embedded file, instead of using a single directory reference for all files.</li>
<li><a href="https://github.com/pvandervelde/nAnicitus/issues/10">#10</a> - Automatically create release notes from resolved GitHub issues. The release notes are created by finding all issues that have been closed between the previous and the current tag. This is using <a href="https://github.com/JakeGinnivan/GitReleaseNotes">GitReleaseNote</a> tool.</li>
</ul>
 
    </div>
</div>
    </div>

    <div id="post-spacer">
    <div id="post">
    <div id="post-header">
        <h2>
            
                <a href='/posts/2014-03-31_Regression-testing-gui-applications.html'>GUI testing with TestStack.White</a>
            
        </h2>
        <div id="post-meta">
            <p>
                Monday, March 31, 2014 | Posted in
                
                    <a id="post-category" href="/tags/regression-testing.html">Regression testing</a>
                
                    <a id="post-category" href="/tags/ui-test.html">UI test</a>
                
                    <a id="post-category" href="/tags/teststack.white.html">TestStack.White</a>
                
                    <a id="post-category" href="/tags/apollo.html">Apollo</a>
                
            </p>
        </div>
    </div>
    <div id="post-content">
        <p>In the <a href="/posts/2014-02-18_Regression-testing-console-applications.html">previous</a> post I explained how I created the regression tests for a script running application that belongs to the <a href="/projects/apollo.html">Apollo</a> project. In this post I will explain how I created the regression tests for an Apollo application with a graphical user interface (UI).</p>
<p>My initial attempt to write a regression test suite for the GUI application was done using the <a href="http://www.nunit.org/">NUnit</a> and <a href="http://scriptcs.net/">ScriptCS</a> with the idea that NUnit would provide the test execution and validation methods and ScriptCs would provide an easy way to write the test scripts without requiring a complete IDE to be used. After some trial-and-error it became clear that this approach was not the most suitable solution for the following reasons:</p>
<ul>
<li>Using NUnit, or any unit test framework for that matter, complicated things because there is no way to take control of the order in which the regression tests are executed. While the ordering of unit tests is irrelevant, the ordering of regression tests may not be in that it is accepted that regression tests involve the execution multiple, ordered tests for one single activation of the application under test (AUT).</li>
<li>A secondary drawback of using a unit test framework is that there is normally no way to re-run a test case if it fails, something which is more acceptable for a regression test than for a unit test.</li>
<li>The test code got rather complicated due to the many helper methods, script files etc.. While ScriptCs coped beautifully with this it turned out to hard for me to work with without the organizing features of a complete IDE.</li>
</ul>
<p>In the end I wrote a custom (console) application that handles the ordering and execution of the different test cases in the way that makes sense for my current requirements.</p>
<h4 id="testing-application">Testing application</h4>
<p>The testing application executes the tests, collects the results and logs all the outputs. When executing the tests each test is executed a maximum of three times before it is marked as a fail. The following code is used by the application to execute the test steps and to keep track of the number of times a test step is executed. </p>
<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_ExecuteTestStep.cs'></script>

<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_TestStep.cs'></script>

<p>The reason for having multiple attempts to complete a test is that the nature of the GUI automation testing is that it is not completely <a href="http://www.mathpirate.net/log/2009/12/23/ui-automation-tricks-and-traps/">consistent</a>. By allowing a test to fail twice it is possible to work around the problem of inconsistent handling of controls.</p>
<p>The second part of the application keeps track of the test results while the tests are running. The application will always try to execute all the tests, irrespective of their final success or failure. That way the user will always have a complete report of the state of all the tests.</p>
<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_EntryPoint.cs'></script>

<p>Finally the application provides utility methods for logging which should be used liberally by both the application and the test steps.</p>
<h4 id="tests">Tests</h4>
<p>In order for the tests to interact with the GUI I chose to use the <a href="https://github.com/TestStack/White">TestStack.White</a> library mainly because it is a mature open source library that has a number of active contributors. One thing to keep in mind when selecting a GUI automation library is that the <a href="http://en.wikipedia.org/wiki/Microsoft_UI_Automation">underlying technology</a> has some tricky hooks to it that cannot be completely hidden by the automation library. One example is that all controls can be found based on their <a href="http://msdn.microsoft.com/en-us/library/aa349646%28v=vs.110%29.aspx">automation ID</a> but windows cannot, even if the window in question has an automation ID.</p>
<p>The main piece of advice for writing UI automation tests is always to write some helper methods to hide the underlying complexity of the UI access technology. In my case I took the following steps:  </p>
<ul>
<li>Control very carefully how your helper methods return information to the caller, either through a return value or through exceptions. In my case if a helper method returns a value it should either return the requested object or null if it fails to get the requested object. The calling code should then always check for null and handle the case of a null return value, e.g. by retrying the method call. The only time the method will throw an exception is if the assumed conditions for the method are wrong, e.g. the application under test (AUT) has crashed. If the helper method has no return value then it may throw if it fails to execute.</li>
</ul>
<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_HelpersForMenu.cs'></script>

<ul>
<li>All actions that get a control will try to get the control several times if they fail. Due to the nature of UI automation it is possible that the control is not available the first time the code tries to get hold of the control. This may be due tot he fact that the automation tests are fast enough that they try to get the control in the 0.1 second that the control is not available yet. Note that this also makes for some very tricky debugging which requires a decent amount of logging. </li>
</ul>
<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_Retry.cs'></script>

<p>Note that automation tests are usually linked strongly to a specific version of the software because the tests assume the availability of certain automation IDs and controls. Some parts are implicitly linked and others can be, but don&#39;t have to be, explicitly linked. Examples are: </p>
<ul>
<li>The application, product and company names can be shared through a configuration or shared code file:</li>
</ul>
<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_CompanyInformation.cs'></script>

<ul>
<li>Automation IDs can be shared via a shared code file. Note that application ID names should be pointing to a given area / functionality, not specific controls (Also note that in my case that&#39;s not always done the right way):</li>
</ul>
<script src='https://gist.github.com/9202656.js?file=Apollo_Regression_AutomationID.cs'></script>

<script src='https://gist.github.com/9202656.js?file=Apollo_Explorer_MenuView.xaml'></script>

<p>When executing the tests it is a good idea to reset your application state either at the end of each test or at the start of each test. Or even better both to make sure that you always start a test from the same state irrespective of the way the previous test ended, e.g. with an application crash.</p>
<p>Finally do not give up if you find it hard to make the tests reliable. By continually improving the robustness of the test code eventually the tests will start to behave in the way you expect them too. Some <a href="http://www.mathpirate.net/log/2009/12/23/ui-automation-tricks-and-traps/">tricks and hacks</a> that I found necessary are:</p>
<ul>
<li>Time-outs while getting controls, setting values on controls or getting values from controls. While these are ugly they are sometimes necessary.</li>
<li>For each test restart the application if at all possible so that you end up with a known application state. This will improve the repeatability of the tests. Note that if the application is slow to start up then you can either improve the start up performance of the application or if that is not possible then carefully combine tests but be aware that tests may fail due to polluted application state. </li>
<li>Note that some application state survives restarts, e.g. user and application settings. It would be good if you have a way of resetting that state in a relatively sure-fire way. This is something I have not implemented yet though.</li>
</ul>
<p>And then the last comment must be that the development of these tests has been much more complicated than I thought it would be. The approach I used required some coding skills so this may or may not be suitable in other situations depending on the skill sets of the testers or developers.</p>
 
    </div>
</div>
    </div>


<!-- Page Listing -->

    <div class="pagination">
        <!-- Previous Page Button -->
        
            <a class="navlinks-prev" href="/index.1.html">Older</a>
        

        <!-- Next Page Button -->
        
    </div>

        </div>
    </div>
    <div id="footer" class="container">
        <div id="fbox1">
            <h2>Related</h2>

<ul>
    <li id="first"><a href="https://github.com/pvandervelde">GitHub</a></li>
    <li><a href="http://www.linkedin.com/profile/view?id=33950311">LinkedIn</a></li>
    <li><a href="http://stackoverflow.com/users/539846/petrik">StackOverflow</a></li>
    <li><a href="http://careers.stackoverflow.com/pvandervelde">StackOverflow Careers</a></li>
    <li><a href="https://plus.google.com/+PatrickvanderVelde/about">Google+</a></li>
</ul>
        </div>
        <div id="fbox2">
            <h2 id="copyright">Copyright</h2>
<p>Copyright (c) 2013 <a href="http://www.petrikvandervelde.nl">http://www.petrikvandervelde.nl</a>. All rights reserved.</p>
<h2 id="disclaimer">Disclaimer</h2>
<p>The opinions expressed herein are my own personal opinions and do not represent my employer&#39;s view in any way.</p>

        </div>
        <div id="fbox3">
            <h2 id="media">Media</h2>
<p><a href="/atom.xml"><img src="/images/feed.png" alt="Atom feed"></a></p>

        </div>
    </div>
    <div id="copyright" class="container">
        <p>
            Site design based on the <a href="http://www.freecsstemplates.org/previews/opentools/">Open Tools</a> design 
            by <a href="http://www.freecsstemplates.org">FreeCSSTemplates.org</a>.
        </p>
        <p>
            Feed icon by <a href="http://www.icojam.com/">Icojam</a> and Favicon by 
            <a href="http://www.flaticon.com/free-icon/twister-sky-wind_12318" title="Yannick">Yannick</a> 
            from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>
        </p>
        <p>Generated by <a href="http://docpad.org/" rel="nofollow">DocPad</a> on Wednesday, May 28, 2014.</p>
    </div>

    <!-- jQuery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/vendor/jquery.js"><\/script>')</script>

    <!-- DocPad Scripts + Our Own -->
    <script >(function(){
	/* Did we just livereload? */
var log = !!(localStorage && console && console.log && true);
if ( log && localStorage.getItem('/docpad-livereload/reloaded') === 'yes' ) {
	localStorage.removeItem('/docpad-livereload/reloaded');
	console.log('LiveReload completed at', new Date())
}

/* Listen for the regenerated event and perform a reload of the page when the event occurs */
var listen = function(){
	var primus = new Primus('/docpad-livereload');
	primus.on('data', function(data){
		if ( data && data.message ) {
			if ( data.message === 'generateBefore' ) {
				if ( log ) {
					console.log('LiveReload started at', new Date());
				}
				if ( typeof document.getElementsByTagName !== 'undefined' ) {
	document.getElementsByTagName('html')[0].className += ' wait';
}
			}
			else if ( data.message === 'generateAfter' ) {
				if ( log ) {
					localStorage.setItem('/docpad-livereload/reloaded', 'yes');
				}
				document.location.reload();
			}
		}
	});
};
	/* Inject socket into our page */
var inject = function(){
	var t = document.createElement('script');
	t.type = 'text/javascript';
	t.async = 'async';
	t.src = '/primus/primus.js';
	t.onload = listen;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(t, s);
};
	if ( typeof Primus !== 'undefined' ) {
		listen();
	} else {
		inject();
	}
})();</script><script >(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-46605109-1');
ga('send', 'pageview');</script><script defer="defer"  src="/vendor/log.js"></script><script defer="defer"  src="/vendor/modernizr.js"></script><script defer="defer"  src="/scripts/script.js"></script>
</body>
</html>
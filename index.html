
<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

    <title>Mind vortex - Mind vortex</title>
    <meta name="description" content="Welcome!" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="application/rss+xml" rel="alternate" title="Mind vortex" href="/feed.rss" />
    <link type="application/atom+xml" rel="alternate" title="Mind vortex" href="/feed.atom" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <link href="/assets/css/normalize.css" rel="stylesheet" />
    <link href="/assets/css/h5bp.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href="/assets/css/override.css" rel="stylesheet" />
    <link href="/assets/css/github.css" rel="stylesheet" type="text/css">


    <meta name="application-name" content="Mind vortex" />
    <meta name="msapplication-tooltip" content="Mind vortex" />
    <meta name="msapplication-starturl" content="/" />

    <meta property="og:title" content="Mind vortex - Mind vortex" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.petrikvandervelde.nl/" />
    <!-- TODO: More social graph meta tags -->

    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/highlight.pack.js"></script>
    <script src="/assets/js/clean-blog.js"></script>
    <script src="/assets/js/d3.v3.min.js"></script>
    <script src="/assets/js/trianglify.min.js"></script>
    <script src="/assets/js/Please-compressed.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="/assets/js/html5shiv.js"></script>
            <script src="/assets/js/respond.min.js"></script>
    <![endif]-->

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        <div id="header" class="container">
            <div id="logo">
                <h1><a href="/">Mind vortex</a></h1>
            </div>
            <div id="menu">
                <ul>
                                <li class="inactive" >
                <a href="/projects">Projects</a>
            </li>
            <li class="active" >
                Mind vortex
            </li>
            <li class="inactive" >
                <a href="/posts">Archive</a>
            </li>
            <li class="inactive" >
                <a href="/about">About</a>
            </li>

                </ul>
            </div>
        </div>

        <div id="page" class="container">
            <div id="sidebar">
                <div id="sbox1">
                    <h2>Patrick van der Velde</h2>

<p>
    <img src="http://www.gravatar.com/avatar/9bc8b3ff385cd14f2b12138c97729df2?s=160" alt="Gravatar for Patrick van der Velde">
</p>
<p>
    Dutch software developer, living, working and playing in New Zealand.
    Rock climber, and paragliding pilot. Developer of <a href="http://pvandervelde.github.io/Sherlock)">Sherlock</a>
    <a href="http://pvandervelde.github.io/Nuclei">Nuclei</a> and other projects
</p>
<p>
    <a href="/about.html">More ...</a>
</p>

                </div>
                <div id="sbox2">
                    <h2>Recent</h2>
                    <ul class="list-unstyled">
                            <li><a href="/posts/nBuildKit-release-V091">nBuildKit release - V0.9.1</a></li>
                            <li><a href="/posts/Ops-Tools-Build-release-V011">Ops-Tools-Build release - V0.1.0 and V0.1.1</a></li>
                            <li><a href="/posts/Ubiquiti-networking-gear">Setting up a home network with Ubiquiti</a></li>
                            <li><a href="/posts/nBuildKit-release-V090">nBuildKit release - V0.9.0</a></li>
                            <li><a href="/posts/Updating-Hyper-v-server-to-Windows2016">Updating my Hyper-V server to Windows 2016</a></li>
                            <li><a href="/posts/Blog-publishing-with-AppVeyor">Blog publishing with AppVeyor</a></li>
                            <li><a href="/posts/Goals-for-2017">Goals for 2017</a></li>
                            <li><a href="/posts/Updating-blog-to-wyam">Exit Docpad, enter Wyam</a></li>
                            <li><a href="/posts/nBuildKit-release-V051">nBuildKit release - V0.5.1</a></li>
                            <li><a href="/posts/nBuildKit-release-V041">nBuildKit release - V0.4.1</a></li>
                    </ul>
                </div>
                <div id="sbox3">
                    <h2>Tags</h2>
                    <div>
                        <ul class="list-unstyled">
                                <li>
                                    <a role="button" href="/tags/sherlock" class="btn btn-default btn-sm"> Sherlock (13)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nbuildkit" class="btn btn-default btn-sm"> nBuildKit (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/paragliding" class="btn btn-default btn-sm"> Paragliding (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/pg2" class="btn btn-default btn-sm"> PG2 (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/blog" class="btn btn-default btn-sm"> Blog (7)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nuclei" class="btn btn-default btn-sm"> Nuclei (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nanicitus" class="btn btn-default btn-sm"> nAnicitus (5)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/docpad" class="btn btn-default btn-sm"> DocPad (3)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/regression-testing" class="btn btn-default btn-sm"> Regression testing (2)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/appveyor" class="btn btn-default btn-sm"> AppVeyor (2)</a>
                                </li>
                        </ul>
                    </div>
                    <br />
                    <ul class="pager">
                        <li class="next">
                            <a href="/tags">View All Tags &rarr;</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="content">
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/nBuildKit-release-V091">nBuildKit release - V0.9.1</a>
</h2>
<div id="post-meta">
    <p>
Sunday, April 9, 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/nbuildkit" class="btn btn-default btn-xs">nBuildKit</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>Hot on the heels of the last release version <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/releases/tag/0.9.1">0.9.1</a>
of <a href="https://github.com/nbuildkit/nBuildKit.MsBuild">nBuildKit</a> has been released. This release fixes
two bugs and adds a few internal improvements.</p>
<p>All the work items that have been closed for this release can be found on
<a href="https://github.com/nbuildkit/nBuildKit.MsBuild/milestone/29?closed=1">github</a>.</p>
<h3>Bugs fixed</h3>
<ul>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/273">273</a> - The <code>CalculateSemanticVersionWithGitVersion</code>
task used the current directory as the working directory. While that is correct in most cases
there are some cases, especially when running the integration tests, where that is not correct.
This has been fixed by requiring the specification of the working directory.</li>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/277">277</a> - In the same way all NuGet tasks
now need a working directory specified in order to make sure that the correct workspace is used
when interacting with the NuGet command line.</li>
</ul>
<h3>Improvements</h3>
<ul>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/272">272</a> - The
<a href="https://github.com/nbuildkit/nBuildKit.MsBuild/blob/master/src/tests/TestFunctions.PrepareWorkspace.ps1">TestFunctions.PrepareWorkspace.ps1</a>
and the <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/blob/master/src/tests/TestFunctions.Git.ps1">TestFunctions.Git.ps1</a>
have been updated with additional functions and checks so that when creating a test workspace the
existing git flow process is only completed if the specified branch exists on the remote. This changes
the completion of the git flow process from mandatory to optional.</li>
<li>Additionally the <code>IsMasterBranch</code> and <code>IsDevelopBranch</code> properties have been defined in the settings
file. These two properties indicate whether or not the current branch is the <code>master</code> or <code>develop</code>
branch respectively.</li>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/69">69</a> - The documentation for nBuildKit itself
is being moved from the wiki to a GitHub pages website. As of this release the build for nBuildKit
will generate the website using <a href="https://wyam.io">Wyam</a>.</li>
</ul>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/Ops-Tools-Build-release-V011">Ops-Tools-Build release - V0.1.0 and V0.1.1</a>
</h2>
<div id="post-meta">
    <p>
Sunday, April 9, 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/ops-tools-build" class="btn btn-default btn-xs">Ops-Tools-Build</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>Last week version <a href="https://github.com/ops-resource/ops-tools-build/releases/tag/0.1.0">0.1.0</a> of the
<a href="https://github.com/ops-resource/ops-tools-build">Ops-Tools-Build</a> toolkit was released. With the recent
<a href="./posts/nBuildKit-release-V091">0.9.1 release of nBuildKit</a> version <a href="https://github.com/ops-resource/ops-tools-build/releases/tag/0.1.1">0.1.1</a>
of the Ops-Tools-Build toolkit was released.</p>
<p>All the work items that have been closed for this release can be found on
<a href="https://github.com/ops-resource/ops-tools-build/milestone/1?closed=1">github</a>.</p>
<h3>New functionality</h3>
<ul>
<li><a href="https://github.com/ops-resource/ops-tools-build/issues/3">3</a> - New scripts have been added to allow
the creation of an ISO file using the <a href="https://sourceforge.net/projects/tumagcc">MakeIsoFS</a> command
line application.</li>
<li><a href="https://github.com/ops-resource/ops-tools-build/issues/4">4</a> - New scripts have been added to allow
invocation of the <a href="https://www.packer.io/">packer</a> command line tool used to generate VM and
container images from a set of configuration files.</li>
<li><a href="https://github.com/ops-resource/ops-tools-build/issues/10">10</a> - New scripts were added to allow
calculation of the hash of one or more files</li>
</ul>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/Ubiquiti-networking-gear">Setting up a home network with Ubiquiti</a>
</h2>
<div id="post-meta">
    <p>
Friday, April 7, 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/hardware" class="btn btn-default btn-xs">Hardware</a>
                    <a id="post-category" role="button" href="/tags/home-network" class="btn btn-default btn-xs">Home network</a>
                    <a id="post-category" role="button" href="/tags/ubiquiti" class="btn btn-default btn-xs">Ubiquiti</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>A little while back we finally got fibre in our street. After spending many years on ADSL (we don't
talk about the time of dial-up ...) it was finally time for some decent network speeds at home. As
the fibre was being installed in my house it was also time to evaluate the networking gear I was
using. Until now I had always used the modem / router provided by the ISP with an additional cheap
switch. The gear always worked fine, but didn't provide configuration options other than the ones that
describe the connection to the ISP. As I was starting to use my <a href="./posts/Updating-Hyper-v-server-to-Windows2016">Hyper-V server</a>
a lot more and was starting to run multiple VM's it would be nice to get some better control over
the network. Additionally based on one of <a href="https://www.troyhunt.com/no-you-cant-join-my-wifi-network/">Troy Hunt's</a>
blog posts I would also like to set up a separate guest network.</p>
<h3>The selection</h3>
<p>The prolific Troy Hunt has written about his <a href="https://www.troyhunt.com/ubiquiti-all-the-things-how-i-finally-fixed-my-dodgy-wifi/">network</a>
setup so I used that as my starting point for finding some new network gear. Fortunately (or unfortunately)
I don't have as much area to cover as Troy does so I didn't need nearly as much hardware. The parts
I got are:</p>
<ul>
<li><a href="https://www.ubnt.com/unifi-routing/usg/">Unifi security gateway</a>: The router which provides amongst
other things a firewall, subnet capabilities and DHCP.</li>
<li><a href="https://www.ubnt.com/unifi-switching/unifi-switch-8/">Unifi switch 8 (US-8-60W)</a>: The managed switch
which has 4 <a href="https://en.wikipedia.org/wiki/Power_over_Ethernet">PoE</a> ports.</li>
<li><a href="https://www.ubnt.com/unifi/unifi-ap-ac-lite/">Unifi AP AC LITE</a>: The smallest indoor access point
available from Ubiquiti. Given that my apartment is relatively small I don't have to worry about
covering a lot of area, and smaller access points are cheaper.</li>
<li><a href="https://www.ubnt.com/unifi/unifi-cloud-key/">Unifi cloud key</a>: The management device which runs
the Unfi software for managing the network.</li>
</ul>
<p>Except for the cloud key this is pretty much the minimal set of hardware required. The cloud key runs
the unifi software which is used to manage the network configuration. You can install the unifi
software on a PC but then you need an extra PC or VM running. While I have a Hyper-V server it was easier
just to pay for the cloud key and have a separate controller for the network. Note that the network
functions just fine without any configuration. However if you want to make changes the easiest way
to do so is through the unifi software, although you could do it by SSH-ing into each device.</p>
<p>Another thing to note is that the the 60W switch has 4 PoE ports of the 802.3af kind. Unfortunately
the access point requires 24V passive PoE. So either you have to:</p>
<ul>
<li>Power the access point of the converter that you get with the access point.</li>
<li>Upgrade the access point to the <a href="https://www.ubnt.com/unifi/unifi-ap-ac-pro/">UAP-AC-PRO</a></li>
<li>Upgrade the switch to the <a href="https://www.ubnt.com/unifi-switching/unifi-switch-8-150w/">US-8-150W</a>
switch which has both 802.3af PoE and 24V passive PoE.</li>
</ul>
<p>As much as I would like to power the access point of the switch I still opted for the first option,
the additional investment wasn't quite worth having one less cable around.</p>
<h3>Configuration</h3>
<p>The actual configuration was pretty easy, plug in all the parts and things start working, at least
for the internal network. Once this is done you can configure the network through the unifi software.
To do so the first thing to do is to to find the cloud key. There's a useful plugin for
<a href="https://chrome.google.com/webstore/detail/ubiquiti-device-discovery/hmpigflbjeapnknladcfphgkemopofig?utm_source=chrome-app-launcher-info-dialog">chrome</a>
that allows you to find any Ubiquiti devices on your local network, otherwise you can try to guess
the IP address of the cloud key. If you only have 4 devices like I do that shouldn't take very long.
The gateway by default assumes you are using the <code>192.168.1.0/24</code> subnet and the gateway is always
the first one.</p>
<p>Once you are logged on to the unifi software it makes sense to give the cloud key a fixed IP address
I gave mine the 192.168.1.2 IP address as I am using the <code>192.168.1.1/24</code> subnet for all my networking
gear. And yes I know I don't have enough networking devices for them to warrant being on their own
subnet but it makes things a little easier and it allows me to learn about <a href="https://en.wikipedia.org/wiki/Subnetwork">subnetting</a>
and <a href="https://en.wikipedia.org/wiki/Virtual_LAN">vlans</a>.</p>
<h3>Subnetting adventures</h3>
<p>As mentioned in the introduction one of the changes I wanted to make was to create a separate guest
network. By default a vlan only guest network is created, however I wanted to move the guests onto
their own subnet so I created a new network with the <code>192.168.5.1/24</code> subnet. I also set the vlan
specifier to <code>1685</code>. And finally I marked this network as a guest network so that the controller
applies the guest firewall rules.</p>
<p>Then I created a wireless guest network with the same vlan. What confused me initially is that there
is no relation between the wireless network and the subnet other than the vlan tag. Somehow having the
same vlan tag is enough to direct the clients onto the the correct subnet.</p>
<p>The last step of the configuration of the guest network is to configure the switch. Because the
access point has three different subnets going to it, the managment subnet for the access point itself,
the guest wifi and the internal wifi, you need to create a custom &lsquo;network&rsquo; on the switch which carries
all three networks, making sure that the untagged network is the one on which you want the access
point to get an IP address.</p>
<p>Another item I found was that for some purposes the standard IP lease of 24 hours is a bit long. One
of the things I'm currently working on is building VM images of different services for use in a test
build environment. While doing that I'm creating <a href="https://github.com/Calvinverse">base boxes</a> for
Windows and Linux which involves spinning up a VM, installing the OS, configuring it and capturing
the image. While working on the code to automate this process I spin up and shut down VMs quite a lot.
If you're using the gateway as the DHCP server and use the standard IP lease time then you run through
IP addresses quite quickly. So I created have a separate IP subnet for those VMs where the IP lease
time is 2 hours (which is more than long enough to create a VM and capture a base image).</p>
<h3>In the end</h3>
<p>In conclusion it's a good set of hardware and software and as a bonus, there are updates which apply
without problems. There is something reassuring in the fact that the manufacturer actually cares enough
about their product that they want to keep it running, unlike much of the consumer gear.</p>
<p>The unifi software provides a lot of useful and interesting capabilities and it's obviously aimed
at the business / educational environment. There are a lot of of features that I don't need, but they
are fun to play with</p>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/nBuildKit-release-V090">nBuildKit release - V0.9.0</a>
</h2>
<div id="post-meta">
    <p>
Monday, April 3, 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/nbuildkit" class="btn btn-default btn-xs">nBuildKit</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>Version <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/releases/tag/0.9.0">0.9.0</a> of <a href="https://github.com/nbuildkit/nBuildKit.MsBuild">nBuildKit</a>
has been released. The last release I talked about on this blog was <a href="posts/nBuildKit-release-V051">0.5.1</a>.
Since then a <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/releases">lot more versions</a> have been
released. The <code>0.9.0</code> release was supposed to be a stabilization release but there were many major
improvements which makes this a major change release.</p>
<p>The highlights are</p>
<ul>
<li>The settings describing artefacts, e.g. the nuspec and zip archive files to build, have moved to
a <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/215">separate file</a> <code>artefacts.settings.props</code>.
This allows each of the different stages, build, test and release, to easily use these settings
without having to load configuration files from the other stages.</li>
<li>All user specific configuration files now have a <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/224">version number</a>
which indicates for which version of nBuildKit they were created. This will allow nBuildKit to
transform older configuration files prior to using them.</li>
<li>The inline tasks have been <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/230">moved to a .NET assembly</a>.
This simplifies the project includes that need to be made to get all the required tasks loaded.
Additionally more complex tasks can be created and <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/234">unit tests can be written and executed</a>
which should improve the quality of the tasks.</li>
<li>User <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/191">defined location</a> and
<a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/192">transformation</a> of the configuration
files prior to starting the build. In combination with the version numbers in the configuration
files this allows nBuildKit to use configuration files from a previous version while still using
the most recent version of nBuildKit. Note that it is currently not possible to upgrade the old
(0.8.3 and prior) configurations to 0.9.0 this way.</li>
<li>Build, test and deploy steps can define <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/196">pre- and post-steps</a>
which are executed before and after the execution of the step. Additionally global pre- and post-steps
can be defined which areo executed before and after each step. These pre- and post-steps can for
instance be used to <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/185">write information to a log file</a>
or to gather post step information.</li>
<li>The <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/206">build server specific code</a> was
moved into separate NuGet packages so that these can be pulled down on the build server only. Three
different packages have been created for <a href="https://jenkins.io/">Jenkins</a>,
<a href="https://msdn.microsoft.com/library/ms181709%28v=vs.120%29.aspx?f=255&amp;MSPPError=-2147217396">TFS2013</a>
and <a href="https://www.visualstudio.com/en-us/docs/build/overview">TFS2015 / TFS2017</a>.</li>
<li>The layout of the scripts and NuGet packages has changed so that it is easier to create a
<a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/220">new set of build tools based on nBuildKit</a>.
With this change it is now possible to create a build / test / deploy library that includes all or
some of the nBuildKit capabilities while providing its own additional capabilities. An example is
the <a href="https://github.com/ops-resource/ops-tools-build">ops-tools-build</a> library which is being used
in the <a href="https://en.wikipedia.org/wiki/Infrastructure_as_Code">infrastructure-as-code</a> work I'm doing.</li>
</ul>
<p>In addition to the major changes some additional build, test and deploy steps have also been defined:</p>
<ul>
<li>Complete a <a href="https://www.atlassian.com/git/tutorials/comparing-workflows#gitflow-workflow">gitflow</a>
stage, e.g. finishing the feature, hotfix or release branch, to verify that the pending merge will
not break the build. Additionally the results of the merge can be captured, by archiving the
<code>.git</code> folder, and can later be used in the deploy process to push the merge to a git remote.</li>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/255">Copying files</a> from the file system or
from a NuGet package.</li>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/238">ILMerge</a> one or more assemblies into a
target assembly.</li>
<li>Generating a targets file from an assembly containing MsBuild tasks.</li>
<li><a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/146">Invoking</a> <a href="https://wyam.io">Wyam</a>
during the build process. Note that this is a late addition and hasn't been tested completely yet</li>
<li>Invoking <a href="https://github.com/pester/Pester">Pester</a> during the test phase.</li>
<li>Pushing files to a git branch during the deploy stage.</li>
<li>Pushing an entire repository to a git remote during the deploy stage.</li>
</ul>
<p>Finally the performance of the whole build process has been improved by changing how the template
tokens are <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/issues/242">generated and loaded</a>. The
overall speed up for the nBuildKit build itself is about a factor two.</p>
<p>All the work items that have been closed for this release can be found on
<a href="https://github.com/nbuildkit/nBuildKit.MsBuild/milestone/26?closed=1">github</a>.</p>

                </div>
            </div>
        </div>
        <div id="post-spacer">
            <div id="post">
                <div id="post-header">
                    <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
            <a href="/posts/Updating-Hyper-v-server-to-Windows2016">Updating my Hyper-V server to Windows 2016</a>
</h2>
<div id="post-meta">
    <p>
Saturday, March 18, 2017
 |         Posted in                     <a id="post-category" role="button" href="/tags/hyper-v" class="btn btn-default btn-xs">Hyper-V</a>
                    <a id="post-category" role="button" href="/tags/windows2016" class="btn btn-default btn-xs">Windows2016</a>
    </p>
</div>

                </div>
                <div id="post-content">
                    <p>One of the computers I have in my home is a Hyper-V server which I use to experiment with all things
virtual machines, e.g. <a href="https://www.thoughtworks.com/insights/blog/infrastructure-code-reason-smile">infrastructure-as-code</a>.
This server was until recently running Windows 2012R2 with the associated version of Hyper-V. With
the release of Windows 2016 a new version of Hyper-V was available which had some interesting
features, like <a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/nested-virtualization">nested virtualization</a>
which allows running VMs on VMs and running Hyper-V containers. All in all enough interesting features
to warrant upgrading my server.</p>
<p>There are however some issues to deal with. The first one being, which version of Windows 2016 are
we going to install? The ideal version to install would be the <a href="https://technet.microsoft.com/en-us/hyper-v-server-docs/hyper-v-server-2016?f=255&amp;MSPPError=-2147217396">bare metal Hyper-V</a>
option with <a href="https://technet.microsoft.com/en-us/windows-server-docs/get-started/windows-server-2016">Windows 2016 server Core</a>
being the second best option. The problem with these version is that it might be harder to
configure the network and attach the machine to the active directory. I currently don't have enough
experience managing Windows through (remote) powershell in order to be able to resolve those kinds
of issues without a large amount of help from Google or Bing. The goal for this exercise is to get
the machine updated so that we can use it, not to get the most lean version of Windows installed, so
I opted to go for the full GUI version of Windows 2016.</p>
<p>To make things more interesting my Active Directory server is a VM running on the Hyper-V server.
And yes I know there should be at least two Active Directory servers on different physical machines
but until I have lots of money and can afford to have multiple servers in my house I will work
with having a single AD server.</p>
<p>The approach I followed to upgrade the operating system on my server to Windows 2016 was as follows.</p>
<ul>
<li>Make backups of everything and be ready to spend some time restoring the AD server, i.e. this is
probably better done as a weekend job.</li>
<li>Create a <a href="https://www.microsoft.com/en-us/download/windows-usb-dvd-download-tool">bootable USB</a>
with the Windows2016 installer.</li>
<li>Attach a keyboard, mouse and monitor to the server so that we can log in to the server directly.
Installing Windows remotely is not possible with my local configuration.</li>
<li>Insert the USB drive, reboot the server and make sure it boots from the USB key</li>
<li>After the Windows installation starts make sure to remove the existing partitions on the original
OS drive. While the OS could be upgraded that also leaves a lot of unused files around. Unfortunately
in that case it will be hard to determine if these files can be deleted or not. By doing a clean
install we can be sure that there will not be any left-overs from the upgrade.</li>
</ul>
<p>Once the new operating system is installed the next step is to restore the VMs. Because all the
VM information was stored on physically different disks than the OS disk all the virtual hard drives
and VM configuration files still exist. In this case it is easy to import the old virtual machines
via the Hyper-V manager.</p>
<p>Once all the VMs were up and running again the last step was to attach the Hyper-V machine to the
domain so that it is easy to use the remote desktop capabilities. Now attaching the machine to
the domain is easy, the problem occurs when you have to restart the Hyper-V machine because after
the reboot the network connection will be set to the public profile instead of the domain profile
which means remote desktop and friends are all blocked. This is all caused by the fact that when the
Hyper-V machine boots up it doesn't have connection to the AD server, because that is a VM running
on the Hyper-V machine, and thus the network profile is set to be public for security purposes.</p>
<p>In order to fix this we need to either force the <a href="https://newsignature.com/articles/network-location-awareness-service-can-ruin-day-fix/">Network Location Awareness service</a> to run
after the AD server has started, or we need to restart the service after a short period. In my case
setting the service start in delayed mode didn't really work so I created a scheduled task which
restarted the service by calling the following command line</p>
<pre><code>C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noprofile -nologo -command &quot;restart-service nlasvc -force&quot;
</code></pre>
<p>Over all the upgrade was easier than I thought and there were only minor set backs. Some of the lessons
that were learned are:</p>
<ul>
<li>Ideally for jobs like this you would have an extra keyboard, mouse and monitor around, that way you
can still use the normal PC for googling issues that you come across.</li>
<li>Importing old VMs in Hyper-V is easy as long as you make sure that you know where all the files
are.</li>
<li>Ideally you would have multiple AD servers, running of different physical machines. Then again
ideally I'd also have lots of money to pay for all these physical machines 😉</li>
</ul>

                </div>
            </div>
        </div>
            </div>
        </div>

        <footer>
            <div id="footer" class="container">
    <div id="fbox1">
        <h2>Related</h2>
        <ul>
            <li id="first"><a href="https://plus.google.com/+PatrickvanderVelde/about"><i class="fa fa-google-plus"></i> Google+</a></li>
            <li><a href="https://github.com/pvandervelde"><i class="fa fa-github"></i> GitHub</a></li>
            <li><a href="http://www.linkedin.com/profile/view?id=33950311"><i class="fa fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="http://stackoverflow.com/users/539846/petrik"><i class="fa fa-stack-overflow"></i> StackOverflow</a></li>
            <li><a href="http://careers.stackoverflow.com/pvandervelde"><i class="fa fa-stack-overflow"></i> StackOverflow Careers</a></li>
            <li><a href="https://twitter.com/petrikvdvelde"><i class="fa fa-twitter"></i> Twitter</a></li>
        </ul>
    </div>
    <div id="fbox2">
        <h2 id="copyright">Copyright</h2>
        <p>Copyright (c) 2017 <a href="/">Petrik van der Velde</a>. All rights reserved.</p>

        <h2 id="disclaimer">Disclaimer</h2>
        <p>The opinions expressed herein are my own personal opinions and do not represent my employer's view in any way.</p>
    </div>
    <div id="fbox3">
        <h2 id="media">Media</h2>
        <p><a href="/feed.atom"><img src="/assets/images/feed.png" alt="Atom feed"></a></p>
    </div>
</div>
<div id="copyright" class="container">
    <div>
        <p>
            Generated by <a href="https://wyam.io">Wyam</a> on Sun, 09 Apr 2017 02:48:47 GMT

 from commit <a href="https://github.com/pvandervelde/mindvortex/tree/0b8680dc37d0018d6764ee341287ed559c1b4b2f">0b8680dc37d0018d6764ee341287ed559c1b4b2f</a> at version 2.4.0.        </p>
    </div>

    <p>
        Site design based on the <a href="http://www.freecsstemplates.org/previews/opentools/">Open Tools</a> design
        by <a href="http://www.freecsstemplates.org">FreeCSSTemplates.org</a>.
    </p>
    <p>
        Feed icon by <a href="http://www.icojam.com/">Icojam</a> and Favicon by
        <a href="http://www.flaticon.com/free-icon/twister-sky-wind_12318" title="Yannick">Yannick</a>
        from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>
    </p>
</div>

        </footer>
    </body>
</html>

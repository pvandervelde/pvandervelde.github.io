
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Mind vortex - Blog publishing with AppVeyor</title>
        <meta name="description" content="Welcome!" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link type="application/rss+xml" rel="alternate" title="Mind vortex" href="/feed.rss" />
        <link type="application/atom+xml" rel="alternate" title="Mind vortex" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/normalize.css" rel="stylesheet" />
        <link href="/assets/css/h5bp.css" rel="stylesheet">
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
        <link href="/assets/css/override.css" rel="stylesheet" />
        <link href="/assets/css/github.css" rel="stylesheet" type="text/css">


        <meta name="application-name" content="Mind vortex" />
        <meta name="msapplication-tooltip" content="Mind vortex" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Mind vortex - Blog publishing with AppVeyor" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.petrikvandervelde.nl/posts/Blog-publishing-with-AppVeyor" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>
        <script src="/assets/js/highlight.pack.js"></script>
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->

        <!-- Our scripts -->
<script src="/assets/js/script.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DV643VJGFT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DV643VJGFT');
</script>


    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        <div id="header" class="container">
            <div id="logo">
                <h1><a href="/">Mind vortex</a></h1>
            </div>
            <div id="menu">
                <ul>
                            <!-- Pages -->
        <!-- BlogPosts -->
        <!-- Tags -->
        <!-- TagIndex -->
        <!-- BlogArchive -->
        <!-- Index -->
        <!-- RenderTagIndex -->
        <!-- RenderTags -->
        <!-- RenderBlogArchive -->
        <!-- Feed -->
        <!-- RenderBlogPosts -->
    <!-- Context.Documents['Pages'] -->
        <!-- 404 Not Found - False - /404 -->
        <!-- About - True - /about -->
        <!-- Apollo - False - /projects/apollo -->
        <!-- Calvinverse - False - /projects/calvinverse -->
        <!-- nAdoni - False - /projects/nadoni -->
        <!-- nAnicitus - False - /projects/nanicitus -->
        <!-- nBuildKit - False - /projects/nbuildkit -->
        <!-- nRefs - False - /projects/nrefs -->
        <!-- nTreva - False - /projects/ntreva -->
        <!-- Nuclei - False - /projects/nuclei -->
        <!-- Ops-Resource - False - /projects/ops-resource -->
        <!-- Projects - True - /projects -->
        <!-- Sherlock - False - /projects/sherlock -->
            <li class="inactive" >
                <a href="/">Home</a>
            </li>
            <li class="inactive" >
                <a href="/projects">Projects</a>
            </li>
            <li class="inactive" >
                <a href="/posts">Archive</a>
            </li>
            <li class="inactive" >
                <a href="/tags">Tags</a>
            </li>
            <li class="inactive" >
                <a href="/about">About</a>
            </li>

                </ul>
            </div>
        </div>

        <div id="page" class="container">
            <div id="sidebar">
                <div id="sbox1">
                    <h2>Patrick van der Velde</h2>

<p>
    <img src="https://www.gravatar.com/avatar/9bc8b3ff385cd14f2b12138c97729df2?s=160" alt="Gravatar for Patrick van der Velde">
</p>
<p>
    Dutch software developer who is living, working and playing in New Zealand.
    Rock climber and paragliding pilot. Developer of
    <a href="https://nbuildkit.github.io/nBuildKit.MsBuild/">nBuildKit</a>,
    <a href="https://github.com/Calvinverse">the Calvinverse resources</a> and other projects.
</p>
<p>
    <a href="/about.html">More ...</a>
</p>

                </div>
                <div id="sbox2">
                    <h2>Recent</h2>
                    <ul class="list-unstyled">
                            <li><a href="/posts/Software-development-pipeline-security">Software development pipeline - Security</a></li>
                            <li><a href="/posts/Software-development-pipeline-infrastructure-dependency-reduction">Software development pipeline - Infrastructure dependency reduction</a></li>
                            <li><a href="/posts/Calvinverse-an-example-build-infrastructure">Calvinverse - An example build infrastructure</a></li>
                            <li><a href="/posts/On-prem-vs-cloud-build-systems">Software development pipeline - On-prem or in the cloud?</a></li>
                            <li><a href="/posts/Software-development-pipeline-considerations-for-infrastructure-improvements">Software development pipeline - Considerations for infrastructure improvements</a></li>
                            <li><a href="/posts/Sofware-development-pipeline-In-the-build-system-or-not">Software development pipeline - In the build system or not</a></li>
                            <li><a href="/posts/Software-development-pipeline-Design-flexibility">Software development pipeline - Design flexibility</a></li>
                            <li><a href="/posts/Software-development-pipeline-Design-resilience">Software development pipeline - Design resilience</a></li>
                            <li><a href="/posts/Software-development-pipeline-Design-performance">Software development pipeline - Design performance</a></li>
                            <li><a href="/posts/Exportable-Linux-virtual-hard-drives-for-hyper-v">Exportable Linux virtual hard-drives for Hyper-V</a></li>
                    </ul>
                </div>
                <div id="sbox3">
                    <h2>Tags</h2>
                    <div>
                        <ul class="list-unstyled">
                                <li>
                                    <a role="button" href="/tags/Sherlock" class="btn btn-default btn-sm"> Sherlock (13)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nBuildKit" class="btn btn-default btn-sm"> nBuildKit (12)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Software-development-pipeline" class="btn btn-default btn-sm"> Software development pipeline (11)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/DevOps" class="btn btn-default btn-sm"> DevOps (11)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Delivering-software" class="btn btn-default btn-sm"> Delivering software (11)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/PG2" class="btn btn-default btn-sm"> PG2 (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Paragliding" class="btn btn-default btn-sm"> Paragliding (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Blog" class="btn btn-default btn-sm"> Blog (7)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Nuclei" class="btn btn-default btn-sm"> Nuclei (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Pipeline-design" class="btn btn-default btn-sm"> Pipeline design (6)</a>
                                </li>
                        </ul>
                    </div>
                    <br />
                    <ul class="pager">
                        <li class="next">
                            <a href="/tags">View All Tags &rarr;</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="content">

<div id="post">
    <div id="post-header">
        <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
Blog publishing with AppVeyor</h2>
<div id="post-meta">
    <div class="meta-date">
Monday, January 16, 2017
 |             Posted in     </div>
    <div class="meta-tags">
                        <a id="post-category" role="button" href="/tags/AppVeyor" class="btn btn-default btn-xs tag-no-wrap">AppVeyor</a>
                        <a id="post-category" role="button" href="/tags/Blog" class="btn btn-default btn-xs tag-no-wrap">Blog</a>
                        <a id="post-category" role="button" href="/tags/Build" class="btn btn-default btn-xs tag-no-wrap">Build</a>
                        <a id="post-category" role="button" href="/tags/Deploy" class="btn btn-default btn-xs tag-no-wrap">Deploy</a>
                        <a id="post-category" role="button" href="/tags/nBuildKit" class="btn btn-default btn-xs tag-no-wrap">nBuildKit</a>
    </div>
</div>

    </div>

    <div id="post-content">
        <p>One part of <a href="/posts/Goals-for-2017">improving my career and increasing my professional reach</a> is to
post more to this blog about the work that I am doing and the code and skills that come from this
work. Unfortunately at the moment writing is still more of a chore than it is a pleasure so that
means that if I want to publish more I need to make it very easy for me to do so, otherwise the publishing
process will just add yet another obstacle that I need to get past while producing content.</p>
<p>With me being a build engineer by profession the obvious solution was not to follow the
<a href="https://www.troyhunt.com/its-a-new-blog/">sensible path</a> of a managed system but to create some
kind of build system to automatically build and publish my blog posts. Troy Hunt is right in
that a managed system is far quicker and easier to use, thereby saving time that you can use for
improvements elsewhere. In my case however I feel that there is something additional to be gotten from
setting my blog up to be automatically build and deployed. To be specific additional learning experiences,
more knowledge and a new blog post about how I achieved the goal. I hope that those things will
make up for the extra work I have to do in maintaining my own blog.</p>
<p>So the goals for this project were</p>
<ul>
<li>Build every time I push to the <a href="https://github.com/pvandervelde/mindvortex">source repository</a> on
an independent environment so that I can be sure that I can always build my blog and nothing is
dependent on my machine being available.</li>
<li>Publishing should involve a minimal amount of work done from my side. Ideally all I would have to
do is commit my changes, merge them to the <a href="https://github.com/pvandervelde/mindvortex">master branch</a>
of the source repository and then sit back and see the new post appear online.</li>
<li>No maintenance is necessary for what ever system I use to achieve this goal. When I build new versions
of one of my libraries, applications or infrastructure resources I want full control over the
build, test and deployment environments. For building my blog that is far less important because
it is a simple process which does not require many different steps.</li>
<li>Finally it would be nice to make it interesting enough to get a blog post out of it.</li>
</ul>
<p>After a few hours of tinkering that is where we are now, this blog post was build and published
using a combination of <a href="https://www.appveyor.com/">AppVeyor</a> as the build server and
<a href="/projects/nBuildKit">nBuildKit</a> for the build and deploy scripts.</p>
<p>In order to achieve this the first step that I took was to set up the build scripts so that I could
build on my local machine. Having a build that executes in the same way on a developer machine
and the build server has many benefits.</p>
<ul>
<li>Familiarity: developers understand what the build server does because it works exactly as on their
machine.</li>
<li>Ease of debugging: it is easier to discover the source of any errors if you can execute the scripts
on a developers machine because then you have have full access to the workspace which may not be
the case on a build machine.</li>
<li>Ease of testing: even build scripts need to be tested. If this is done on a developer machine then
the testing will most likely be able to be executed much quicker because there is less need to
commit every change, push it to the server and wait for the build server to execute the build.</li>
</ul>
<p>Configuring <code>nBuildKit</code> means copying the <a href="https://github.com/nbuildkit/nBuildKit.MsBuild/tree/master/src/samples">sample files</a>
to the root of the workspace and updating them with values relevant to the project.</p>
<p>In this case I updated the <code>settings.props</code> file, which contains the general information about the
build, test and deploy processes, with <a href="https://gist.github.com/pvandervelde/88aa8f644148b4cdb9fa909fe3ff8f69">product information</a>.</p>
<p>I also <a href="https://gist.github.com/pvandervelde/9853b15889ccf67bafa5fa2e93594ca2">enabled the automatic merging</a>
for the <a href="https://nvie.com/posts/a-successful-git-branching-model/">GitFlow</a> process. This allows
nBuildKit to automatically complete feature, hotfix and release branches when running on a build
server so that each build also verifies that the final merge will be successful and the changes will
not break anything after the merge.</p>
<p>The next file to update was the <code>build.settings.props</code> file, which describes what needs to be done
during the build process, was updated. The first part of that was to define which <a href="https://gist.github.com/pvandervelde/015611f5355b07e1b3246ae81bf2ea0a">steps should be
taken during the build process</a>.</p>
<ul>
<li>Clear the workspace. While this is not necessary on a build server, after all a fresh workspace
is used for each build, it is necessary on a developer machine because old artefacts may still
be present.</li>
<li>Ensure that the build server has configured the workspace with the correct source control information.
Many build systems do not perform a full clone at the start of a build but rather get only the
minimal source control information in addition to the source files. This reduces time and IO
demands, especially for repositories with extensive history. Different build systems have a
different approach to what steps exactly are taken. The lack of source control information, e.g.
the state of different branches, or the branch that the current commit is part of, is not a
problem if the only step is to compiling code however issues can occur if the state of the local
workspace is used to determine version numbers or VCS information. In those cases it is better to
ensure that the workspace is in the same state as it was on the developers machine.</li>
<li>Gather VCS information like the current commit ID and the branch name. For my blog this information
is embedded in the footer of every page to indicate which commit was build and what version
of the blog you are looking at.</li>
<li>Complete the active <code>GitFlow</code> branch, if there is one, by merging the active branch to the
appropriate target branches and adding tags if necessary.</li>
<li>Get version information with <a href="https://github.com/GitTools/GitVersion">GitVersion</a>. This
is done after the merge process so that the version number is the release version.</li>
<li><a href="https://gist.github.com/pvandervelde/813a19ff4861470ba03591a5ecc4b910">Build the pages</a> with Wyam.</li>
<li>Zip up the generated pages</li>
</ul>
<p>The final change to the <code>build.settings.props</code> file was to enable the generation of the archive
files by <a href="https://gist.github.com/pvandervelde/d1ec2c78fc560bd20ef1ef7a375eee30">uncommenting the <code>ArchivePackageSpecs</code> section</a>.</p>
<p>The last file to be changed was the <code>deploy.settings.props</code> file which describes what needs to be
done during the deploy process. As with the <code>build.settings.props</code> file the first step here was
to select the <a href="https://gist.github.com/pvandervelde/8ee5a1dc96d0835bb8b3aa6354896ba7">steps that should be taken during the deploy process</a>.</p>
<ul>
<li>Once again ensure that the build server workspace is configured with the correct source control
information.</li>
<li>Gather version information in the same way as was done during the build process.</li>
<li><a href="https://gist.github.com/pvandervelde/c6490e33fd73d0f7afc15677a4bf2e8b">Push the archive files</a>
to AppVeyor.</li>
<li>Push the files contained in the archive file to the <a href="https://github.com/pvandervelde/pvandervelde.github.io">repository</a>
that contains the generated pages. This was simply done by enabling the <code>DeployStepsPushToGitBranch</code>
deploy step and <a href="https://gist.github.com/pvandervelde/9a2dd811faf4d0e56ef3b5069d2e7d3c">providing information about the repository and branch</a>
that the files should be pushed to. The commit message for this process currently comes from a text
file in the root of the repository. Ideally there would be some way to discover a decent commit
message, e.g. the name of the most recent post, however many different changes are pushed to the
source repository so selecting the correct commit message is somewhat difficult.</li>
</ul>
<p>By updating these three files we have provided <code>nBuildKit</code> with enough information to execute both
the build and deploy processes.</p>
<p>Once the build scripts were complete and tested the only thing that remained was to configure
AppVeyor. This can either be done through the <a href="https://www.appveyor.com/docs/build-configuration/">UI or a YAML file</a>.
In this case I elected to use the <a href="https://gist.github.com/pvandervelde/4171a3b81776132e2800a3f9b802fa43">YAML file</a>
so that all information describing my build and deployment process would exist in the repository.</p>
<p>In order to create the configuration file I copied the <a href="https://www.appveyor.com/docs/appveyor-yml/">reference file</a>
and then removed all the bits I didn't need. The only tricky bit was setting up the AppVeyor
environment so that the deploy process could push the final results back to GitHub. For that I
added a <a href="https://github.com/blog/2024-read-only-deploy-keys">deploy key</a> to the target repository.
The private part of this key was then encrypted and placed in the YAML file. Some <code>before_deploy</code>
<a href="https://www.appveyor.com/docs/how-to/private-git-sub-modules/">script magic</a> allows the decryption
of the key so that git can push the changes to the repository via SSH.</p>

    </div>

    <div id="post-footer">
        <div>
    <div class="navlinks">
                <a href="/posts/Goals-for-2017" title="Previous Post: Goals for 2017" class="navlinks-prev">« Goals for 2017</a>
                <a href="/posts/Updating-Hyper-v-server-to-Windows2016" title="Next Post: Updating my Hyper-V server to Windows 2016" class="navlinks-next">Updating my Hyper-V server to Windows 2016 »</a>
    </div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'mindvortex'; // required: replace example with your forum shortname
    var disqus_identifier = 'Blog-publishing-with-AppVeyor';
    var disqus_title = 'Blog publishing with AppVeyor';
    var disqus_url = 'https://www.petrikvandervelde.nl/posts/Blog-publishing-with-AppVeyor';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
</div>







            </div>
        </div>

        <footer>
            <div id="footer" class="container">
    <div id="fbox1">
        <h2>Related</h2>
        <ul>
            <li><a href="https://github.com/pvandervelde"><i class="fa fa-github"></i> GitHub</a></li>
            <li><a href="https://www.linkedin.com/profile/view?id=33950311"><i class="fa fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="https://stackoverflow.com/users/539846/petrik"><i class="fa fa-stack-overflow"></i> StackOverflow</a></li>
            <li><a href="https://careers.stackoverflow.com/pvandervelde"><i class="fa fa-stack-overflow"></i> StackOverflow Careers</a></li>
            <li><a href="https://twitter.com/petrikvdvelde"><i class="fa fa-twitter"></i> Twitter</a></li>
            <li><a href="https://profile.codersrank.io/user/pvandervelde">CodersRank</a></li>
        </ul>
    </div>
    <div id="fbox2">
        <h2 id="copyright">Copyright</h2>
        <p>Copyright (c) 2020 <a href="/">Petrik van der Velde</a>. All rights reserved.</p>

        <h2 id="disclaimer">Disclaimer</h2>
        <p>The opinions expressed herein are my own personal opinions and do not represent my employer's view in any way.</p>
    </div>
    <div id="fbox3">
        <h2 id="media">Media</h2>
        <p><a href="/feed.atom"><img src="/assets/images/feed.png" alt="Atom feed"></a></p>
    </div>
</div>
<div id="copyright" class="container">
    <div>
        <p>
            Generated by <a href="https://wyam.io">Wyam</a> on Sun, 08 Nov 2020 05:19:23 GMT

 from commit <a href="https://github.com/pvandervelde/mindvortex/tree/d4df0d1b82fc07e5f18bf11d0c4414cb403f9303">d4df0d1b82fc07e5f18bf11d0c4414cb403f9303</a> at version 3.3.0.        </p>
    </div>

    <p>
        Site design based on the <a href="https://www.freecsstemplates.org/previews/opentools/">Open Tools</a> design
        by <a href="https://www.freecsstemplates.org">FreeCSSTemplates.org</a>.
    </p>
    <p>
        Feed icon by <a href="https://www.icojam.com/">Icojam</a> and Favicon by
        <a href="https://www.flaticon.com/free-icon/twister-sky-wind_12318" title="Yannick">Yannick</a>
        from <a href="https://www.flaticon.com" title="Flaticon">www.flaticon.com</a>
    </p>
</div>

        </footer>
    </body>
</html>

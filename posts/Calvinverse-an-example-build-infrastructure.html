
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Mind vortex - Calvinverse - An example build infrastructure</title>
        <meta name="description" content="Welcome!" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link type="application/rss+xml" rel="alternate" title="Mind vortex" href="/feed.rss" />
        <link type="application/atom+xml" rel="alternate" title="Mind vortex" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/normalize.css" rel="stylesheet" />
        <link href="/assets/css/h5bp.css" rel="stylesheet">
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
        <link href="/assets/css/override.css" rel="stylesheet" />
        <link href="/assets/css/github.css" rel="stylesheet" type="text/css">


        <meta name="application-name" content="Mind vortex" />
        <meta name="msapplication-tooltip" content="Mind vortex" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Mind vortex - Calvinverse - An example build infrastructure" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.petrikvandervelde.nl/posts/Calvinverse-an-example-build-infrastructure" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>
        <script src="/assets/js/highlight.pack.js"></script>
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->

        <!-- Our scripts -->
<script src="/assets/js/script.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DV643VJGFT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DV643VJGFT');
</script>


    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        <div id="header" class="container">
            <div id="logo">
                <h1><a href="/">Mind vortex</a></h1>
            </div>
            <div id="menu">
                <ul>
                            <!-- Pages -->
        <!-- BlogPosts -->
        <!-- Tags -->
        <!-- TagIndex -->
        <!-- BlogArchive -->
        <!-- Index -->
        <!-- RenderTagIndex -->
        <!-- RenderTags -->
        <!-- RenderBlogArchive -->
        <!-- Feed -->
        <!-- RenderBlogPosts -->
    <!-- Context.Documents['Pages'] -->
        <!-- 404 Not Found - False - /404 -->
        <!-- About - True - /about -->
        <!-- Calvinverse - False - /projects/calvinverse -->
        <!-- nBuildKit - False - /projects/nbuildkit -->
        <!-- Projects - True - /projects -->
        <!-- Scuttle - False - /projects/scuttle -->
            <li class="inactive" >
                <a href="/">Home</a>
            </li>
            <li class="inactive" >
                <a href="/projects">Projects</a>
            </li>
            <li class="inactive" >
                <a href="/posts">Archive</a>
            </li>
            <li class="inactive" >
                <a href="/tags">Tags</a>
            </li>
            <li class="inactive" >
                <a href="/about">About</a>
            </li>

                </ul>
            </div>
        </div>

        <div id="page" class="container">
            <div id="sidebar">
                <div id="sbox1">
                    <h2>Patrick van der Velde</h2>

<p>
    <img src="https://www.gravatar.com/avatar/9bc8b3ff385cd14f2b12138c97729df2?s=160" alt="Gravatar for Patrick van der Velde">
</p>
<p>
    Dutch software developer who is living, working and playing in New Zealand.
    Rock climber and paragliding pilot. Developer of
    <a href="https://nbuildkit.github.io/nBuildKit.MsBuild/">nBuildKit</a>,
    <a href="https://github.com/Calvinverse">the Calvinverse resources</a> and other projects.
</p>
<p>
    <a href="/about.html">More ...</a>
</p>

                </div>
                <div id="sbox2">
                    <h2>Recent</h2>
                    <ul class="list-unstyled">
                            <li><a href="/posts/Robotics-a-bumper-for-scuttle-software">Starting robotics - Building a bumper for scuttle. The software</a></li>
                            <li><a href="/posts/Robotics-a-bumper-for-scuttle-overview">Starting robotics - Building a bumper for scuttle. The overview</a></li>
                            <li><a href="/posts/Robotics-driving-scuttle-with-ros-gazebo-simulation">Starting robotics - Driving scuttle with ROS - Gazebo simulation</a></li>
                            <li><a href="/posts/Robotics-learning-ros">Starting robotics - Learning Robot Operating System (ROS)</a></li>
                            <li><a href="/posts/Starting-robotics-with-scuttle">Starting robotics with the SCUTTLE robot</a></li>
                            <li><a href="/posts/Building-autonomous-mobile-robot-why">Building an autonomous mobile robot - But why?</a></li>
                            <li><a href="/posts/Software-development-pipeline-security">Software development pipeline - Security</a></li>
                            <li><a href="/posts/Software-development-pipeline-infrastructure-dependency-reduction">Software development pipeline - Infrastructure dependency reduction</a></li>
                            <li><a href="/posts/Calvinverse-an-example-build-infrastructure">Calvinverse - An example build infrastructure</a></li>
                            <li><a href="/posts/On-prem-vs-cloud-build-systems">Software development pipeline - On-prem or in the cloud?</a></li>
                    </ul>
                </div>
                <div id="sbox3">
                    <h2>Tags</h2>
                    <div>
                        <ul class="list-unstyled">
                                <li>
                                    <a role="button" href="/tags/Sherlock" class="btn btn-default btn-sm"> Sherlock (13)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nBuildKit" class="btn btn-default btn-sm"> nBuildKit (12)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Delivering-software" class="btn btn-default btn-sm"> Delivering software (11)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Software-development-pipeline" class="btn btn-default btn-sm"> Software development pipeline (11)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/DevOps" class="btn btn-default btn-sm"> DevOps (11)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/PG2" class="btn btn-default btn-sm"> PG2 (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Paragliding" class="btn btn-default btn-sm"> Paragliding (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Blog" class="btn btn-default btn-sm"> Blog (7)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Pipeline-design" class="btn btn-default btn-sm"> Pipeline design (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/Robotics" class="btn btn-default btn-sm"> Robotics (6)</a>
                                </li>
                        </ul>
                    </div>
                    <br />
                    <ul class="pager">
                        <li class="next">
                            <a href="/tags">View All Tags &rarr;</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="content">

<div id="post">
    <div id="post-header">
        <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
Calvinverse - An example build infrastructure</h2>
<div id="post-meta">
    <div class="meta-date">
Friday, June 28, 2019
 |             Posted in     </div>
    <div class="meta-tags">
                        <a id="post-category" role="button" href="/tags/Calvinverse" class="btn btn-default btn-xs tag-no-wrap">Calvinverse</a>
                        <a id="post-category" role="button" href="/tags/Delivering-software" class="btn btn-default btn-xs tag-no-wrap">Delivering&nbsp;software</a>
                        <a id="post-category" role="button" href="/tags/DevOps" class="btn btn-default btn-xs tag-no-wrap">DevOps</a>
                        <a id="post-category" role="button" href="/tags/Immutable-infrastructure" class="btn btn-default btn-xs tag-no-wrap">Immutable&nbsp;infrastructure</a>
                        <a id="post-category" role="button" href="/tags/Software-development-pipeline" class="btn btn-default btn-xs tag-no-wrap">Software&nbsp;development&nbsp;pipeline</a>
    </div>
</div>

    </div>

    <div id="post-content">
        <p>This post introduces the <a href="https://www.calvinverse.net/">Calvinverse</a>
<a href="https://github.com/Calvinverse">project</a> which provides the source code for the different resources
required to create the infrastructure for a build pipeline. The Calvinverse resources have been
developed for two main reasons:</p>
<ul>
<li>To provide me with a way to experiment with and learn more about
<a href="https://thenewstack.io/a-brief-look-at-immutable-infrastructure-and-why-it-is-such-a-quest/">immutable</a> <a href="https://twitter.com/jezhumble/status/970334897544900609">infrastructure</a> and
<a href="https://en.wikipedia.org/wiki/Infrastructure_as_code">infrastructure-as-code</a> as applied to build infrastructure.</li>
<li>To provide resources that can be used to set up the infrastructure for a complete
<a href="/posts/On-prem-vs-cloud-build-systems">on-prem</a> build system. The system should provide a build
controller with build agents, artefact storage and all the necessary tools to monitor the different
services and diagnose issues.</li>
</ul>
<p>The Calvinverse resources can be configured and deployed for different sizes of infrastructure, from
small setups only used by a few developers to a large setup used by many developers for the development
of many products. How to configure the resources for small, medium or large environments and their
hardware requirements will be discussed in future posts.</p>
<p>The resources in the Calvinverse project are designed to be run as a self-contained system. While
daily maintenance is minimal it is not a hosted system so some maintenance is required. For instance
OS updates will be required on a regular basis. These can either be applied to existing resources,
through the automatic updates, or by applying the new updates to the templates and then replacing
the existing resources with a new instance. The latter approach case can be automated, however there
is no code in any of the Calvinverse repositories to do this automatically.</p>
<p>The different resources in the Calvinverse project contain a set of tools and applications which
provide all the necessary capabilities to create the infrastructure for a build pipeline. Amongst these
capabilities are service discovery, build execution, artefact storage, metrics, alerting and
log processing.</p>
<p>The following applications and approaches are used for service discovery and configuration storage:</p>
<ul>
<li>Using <a href="https://www.consul.io">Consul</a> to provide service discovery and machine discovery via
<a href="https://www.consul.io/docs/agent/dns.html">DNS</a> inside an environment. An environment is defined
as all machines that are part of a <a href="https://www.consul.io/docs/internals/architecture.html">consul datacenter</a>.
It is possible to have multiple environments where the machines may all be on the same network but
in general will not be communicating across environments. This is useful for cases where having
multiple environments makes sense, for instance when having a production environment and a test
environment. The benefit of using Consul as a DNS is that it allows a resource to have a consistent
name across different environments without the DNS names clashing. For instance if there is a
production environment and a test environment then it is possible to use the same DNS name
for a resource, even though the actual machine names will be different. This allows using the
Consul DNS name in tools and scripts without having to keep in mind the environment the tool
is deployed in.
Finally Consul is also used for the distributed key-value store that all applications can obtain
configuration information from thereby centralizing the configuration information.</li>
<li>Using one or more <a href="https://vaultproject.io">Vault</a> instance to handle all the secrets required
for the environment. Vault provides authenticated access for resources to securely access secrets,
login credentials and other information that should be kept secure. This allows centralizing the
storage and distribution of secrets</li>
</ul>
<p>For the build work Calvinverse uses the following applications:</p>
<ul>
<li><a href="https://jenkins.io">Jenkins</a> is used as the
<a href="https://github.com/Calvinverse/resource.build.master">build controller</a>.</li>
<li>Build executors connect to Jenkins using the <a href="https://plugins.jenkins.io/swarm">swarm plugin</a> so
that agents can connect when it starts. In the Calvinverse project there are currently only
<a href="https://github.com/Calvinverse/resource.build.agent.windows">Windows</a> based executors.</li>
</ul>
<p>For <a href="https://github.com/Calvinverse/resource.artefacts">artefact storage</a> Calvin verse uses the
<a href="https://www.sonatype.com/nexus-repository-oss">Nexus</a> application. The image is configured such that
a new instance of the image will create artefact repositories for <a href="https://www.nuget.org">NuGet</a>,
<a href="https://www.npmjs.com/">Npm</a>, <a href="https://www.docker.com/">Docker</a> and general ZIP artefacts.</p>
<p>For <a href="https://github.com/Calvinverse/resource.queue">message distribution</a> Calvinverse uses the <a href="https://www.rabbitmq.com/">RabbitMQ</a> application. The image is configured such that a new instance of the image will
try to connect to the existing cluster in the environment. If no cluster exists then the first
instance of the image will form the start of the cluster in the environment.</p>
<p>Metrics, monitoring and alerting capabilities are provided by the
<a href="https://www.influxdata.com/">Influx</a> stack, consisting of:</p>
<ul>
<li><a href="https://www.influxdata.com/time-series-platform/">InfluxDB</a> for
<a href="https://github.com/Calvinverse/resource.metrics.storage">metrics collection</a>.</li>
<li><a href="https://grafana.com/">Grafana</a> for <a href="https://github.com/Calvinverse/resource.metrics.dashboard">dashboards</a>.</li>
<li><a href="https://www.rabbitmq.com/">Telegraf</a> is installed on each resource to collect metrics and send
them to InfluxDb.</li>
<li><a href="https://www.influxdata.com/time-series-platform/chronograf/">Chronograf</a> for
<a href="https://github.com/Calvinverse/resource.metrics.monitoring">alert configurations</a>.</li>
<li><a href="https://www.influxdata.com/time-series-platform/kapacitor/">Kapacitor</a> for
<a href="https://github.com/Calvinverse/resource.metrics.monitoring">alerting</a>.</li>
</ul>
<p>Build and system logs are processed by the <a href="https://www.elastic.co/">Elastic</a> stack consisting off:</p>
<ul>
<li><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> for
<a href="https://github.com/Calvinverse/resource.documents.storage">log storage</a>, both system logs
and build logs</li>
<li><a href="https://www.elastic.co/products/kibana">Kibana</a> for
<a href="https://github.com/Calvinverse/resource.documents.dashboard">log dashboards</a>.</li>
<li>Logs collected via <a href="https://www.syslog-ng.com/products/open-source-log-management/">syslog-ng</a> on
Linux and a modified version of <a href="https://github.com/pvandervelde/filebeat.mqtt">Filebeat</a> on windows.
Logs are sent to RabbitMQ to ensure that the unprocessed logs aren't lost when something any part
of the log stack goes offline.</li>
<li><a href="https://www.elastic.co/products/logstash">Logstash</a> for
<a href="https://github.com/Calvinverse/resource.logs.processor">processing logs</a> from RabbitMQ to
Elasticsearch using <a href="https://github.com/Calvinverse/calvinverse.logs.filters">filters</a></li>
</ul>
<p>It should be noted that while the Calvinverse resources combine to create a complete build environment
the resources might need some alterations to fit in with the work flow and processes that are being
followed. After all each company is different and applies different workflows. Additionally users
might want to replace some of the resources with versions of their own, e.g. to replace Influx with
<a href="https://prometheus.io/">Prometheus</a>.</p>

    </div>

    <div id="post-footer">
        <div>
    <div class="navlinks">
                <a href="/posts/On-prem-vs-cloud-build-systems" title="Previous Post: Software development pipeline - On-prem or in the cloud?" class="navlinks-prev">« Software development pipeline - On-prem or in the cloud?</a>
                <a href="/posts/Software-development-pipeline-infrastructure-dependency-reduction" title="Next Post: Software development pipeline - Infrastructure dependency reduction" class="navlinks-next">Software development pipeline - Infrastructure dependency reduction »</a>
    </div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'mindvortex'; // required: replace example with your forum shortname
    var disqus_identifier = 'Calvinverse-an-example-build-infrastructure';
    var disqus_title = 'Calvinverse - An example build infrastructure';
    var disqus_url = 'https://www.petrikvandervelde.nl/posts/Calvinverse-an-example-build-infrastructure';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
</div>







            </div>
        </div>

        <footer>
            <div id="footer" class="container">
    <div id="fbox1">
        <h2>Related</h2>
        <ul>
            <li><a href="https://github.com/pvandervelde"><i class="fa fa-github"></i> GitHub</a></li>
            <li><a href="https://www.linkedin.com/profile/view?id=33950311"><i class="fa fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="https://stackoverflow.com/users/539846/petrik"><i class="fa fa-stack-overflow"></i> StackOverflow</a></li>
            <li><a href="https://careers.stackoverflow.com/pvandervelde"><i class="fa fa-stack-overflow"></i> StackOverflow Careers</a></li>
            <li><a href="https://profile.codersrank.io/user/pvandervelde">CodersRank</a></li>
        </ul>
    </div>
    <div id="fbox2">
        <h2 id="copyright">Copyright</h2>
        <p>Copyright (c) 2022 <a href="/">Petrik van der Velde</a>. All rights reserved.</p>

        <h2 id="disclaimer">Disclaimer</h2>
        <p>The opinions expressed herein are my own personal opinions and do not represent my employer's view in any way.</p>
    </div>
    <div id="fbox3">
        <h2 id="media">Media</h2>
        <p><a href="/feed.atom"><img src="/assets/images/feed.png" alt="Atom feed"></a></p>
    </div>
</div>
<div id="copyright" class="container">
    <div>
        <p>
            Generated by <a href="https://wyam.io">Wyam</a> on Fri, 09 Sep 2022 07:16:51 GMT

 from commit <a href="https://github.com/pvandervelde/mindvortex/tree/62fc793f8eacf7a47644801d34c14b43863dc285">62fc793f8eacf7a47644801d34c14b43863dc285</a> at version 3.9.0.        </p>
    </div>

    <p>
        Site design based on the <a href="https://www.freecsstemplates.org/previews/opentools/">Open Tools</a> design
        by <a href="https://www.freecsstemplates.org">FreeCSSTemplates.org</a>.
    </p>
    <p>
        Feed icon by <a href="https://www.icojam.com/">Icojam</a> and Favicon by
        <a href="https://www.flaticon.com/free-icon/twister-sky-wind_12318" title="Yannick">Yannick</a>
        from <a href="https://www.flaticon.com" title="Flaticon">www.flaticon.com</a>
    </p>
</div>

        </footer>
    </body>
</html>

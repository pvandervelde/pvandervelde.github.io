
<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

    <title>Mind vortex - Sherlock configuration - Virtual machines</title>
    <meta name="description" content="Welcome!" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="application/rss+xml" rel="alternate" title="Mind vortex" href="/feed.rss" />
    <link type="application/atom+xml" rel="alternate" title="Mind vortex" href="/feed.atom" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <link href="/assets/css/normalize.css" rel="stylesheet" />
    <link href="/assets/css/h5bp.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href="/assets/css/override.css" rel="stylesheet" />
    <link href="/assets/css/github.css" rel="stylesheet" type="text/css">


    <meta name="application-name" content="Mind vortex" />
    <meta name="msapplication-tooltip" content="Mind vortex" />
    <meta name="msapplication-starturl" content="/" />

    <meta property="og:title" content="Mind vortex - Sherlock configuration - Virtual machines" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.petrikvandervelde.nl/posts/Setting-up-Sherlock-virtualmachines" />
    <!-- TODO: More social graph meta tags -->

    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/highlight.pack.js"></script>
    <script src="/assets/js/clean-blog.js"></script>
    <script src="/assets/js/d3.v3.min.js"></script>
    <script src="/assets/js/trianglify.min.js"></script>
    <script src="/assets/js/Please-compressed.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="/assets/js/html5shiv.js"></script>
            <script src="/assets/js/respond.min.js"></script>
    <![endif]-->

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        <div id="header" class="container">
            <div id="logo">
                <h1><a href="/">Mind vortex</a></h1>
            </div>
            <div id="menu">
                <ul>
                                <li class="inactive" >
                <a href="/">Home</a>
            </li>
            <li class="inactive" >
                <a href="/projects">Projects</a>
            </li>
            <li class="inactive" >
                <a href="/posts">Archive</a>
            </li>
            <li class="inactive" >
                <a href="/about">About</a>
            </li>

                </ul>
            </div>
        </div>

        <div id="page" class="container">
            <div id="sidebar">
                <div id="sbox1">
                    <h2>Patrick van der Velde</h2>

<p>
    <img src="http://www.gravatar.com/avatar/9bc8b3ff385cd14f2b12138c97729df2?s=160" alt="Gravatar for Patrick van der Velde">
</p>
<p>
    Dutch software developer, living, working and playing in New Zealand.
    Rock climber, and paragliding pilot. Developer of <a href="http://pvandervelde.github.io/Sherlock)">Sherlock</a>
    <a href="http://pvandervelde.github.io/Nuclei">Nuclei</a> and other projects
</p>
<p>
    <a href="/about.html">More ...</a>
</p>

                </div>
                <div id="sbox2">
                    <h2>Recent</h2>
                    <ul class="list-unstyled">
                            <li><a href="/posts/Goals-for-2017">Goals for 2017</a></li>
                            <li><a href="/posts/Updating-blog-to-wyam">Exit Docpad, enter Wyam</a></li>
                            <li><a href="/posts/nBuildKit-release-V051">nBuildKit release - V0.5.1</a></li>
                            <li><a href="/posts/nBuildKit-release-V041">nBuildKit release - V0.4.1</a></li>
                            <li><a href="/posts/Creating-azure-vm-images-with-powershell">Creating Azure VM images with Powershell</a></li>
                            <li><a href="/posts/Building-and-delivering-nBuildKit-with-AppVeyor">Building and delivering nBuildKit with AppVeyor</a></li>
                            <li><a href="/posts/nBuildKit-release-V032">nBuildKit release - V0.3.2</a></li>
                            <li><a href="/posts/Adding-pagination-with-DocPad">Adding pagination with DocPad</a></li>
                            <li><a href="/posts/Blog-archives-by-DocPad">Blog archives by DocPad</a></li>
                            <li><a href="/posts/nBuildKit-release-V024">nBuildKit release - V0.2.4</a></li>
                    </ul>
                </div>
                <div id="sbox3">
                    <h2>Tags</h2>
                    <div>
                        <ul class="list-unstyled">
                                <li>
                                    <a role="button" href="/tags/sherlock" class="btn btn-default btn-sm"> Sherlock (13)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/pg2" class="btn btn-default btn-sm"> PG2 (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/paragliding" class="btn btn-default btn-sm"> Paragliding (9)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/blog" class="btn btn-default btn-sm"> Blog (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nbuildkit" class="btn btn-default btn-sm"> nBuildKit (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nuclei" class="btn btn-default btn-sm"> Nuclei (6)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nanicitus" class="btn btn-default btn-sm"> nAnicitus (5)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/docpad" class="btn btn-default btn-sm"> DocPad (3)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/nadoni" class="btn btn-default btn-sm"> nAdoni (2)</a>
                                </li>
                                <li>
                                    <a role="button" href="/tags/pdb" class="btn btn-default btn-sm"> PDB (2)</a>
                                </li>
                        </ul>
                    </div>
                    <br />
                    <ul class="pager">
                        <li class="next">
                            <a href="/tags">View All Tags &rarr;</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="content">

<div id="post">
    <div id="post-header">
        <!--
    Model is: Tuple<IDocument, IDocument>.
    The first one is the current document that is being rendered, the second one is the one for which the post header should be rendered.
-->


<h2>
Sherlock configuration - Virtual machines</h2>
<div id="post-meta">
    <p>
Wednesday, 11 December 2013
 |         Posted in                     <a id="post-category" role="button" href="/tags/sherlock" class="btn btn-default btn-xs">Sherlock</a>
    </p>
</div>

    </div>

    <div id="post-content">
        <p>After <a href="/posts/Setting-up-Sherlock-serverside.html">setting up the host machine</a> the next step in
the <a href="/posts/Regression-testing-with-Sherlock.html">configuration</a> of Sherlock is to set up one or
more virtual machines. Each virtual machine will have the following applications installed:</p>
<ul>
<li>The update service which handles the installation of the latest available Sherlock binaries.</li>
<li>The executor service which handles the communication with the master controller, handles the
download and upload of test files and test reports and controls the test execution.</li>
<li>The application which executes the test steps. This has been separated from the service so that:
<ul>
<li>It is possible to run the application on the desktop while the executor service is running as
a Windows service.</li>
<li>Any fatal errors in the test application don't affect the service, thereby maintaining
communication with the master controller, and thus allowing error reports to be send.</li>
<li>It is possible to run multiple applications under different accounts (planned in future releases).</li>
</ul>
</li>
</ul>
<p>The configuration process for a virtual machine consists of the following steps:</p>
<ul>
<li>Create a new virtual machine and install the operating system</li>
<li>Configure the operating system on the virtual machine</li>
<li>Install and configure the Sherlock applications on the virtual machine</li>
<li>Store information about the virtual machine in the host database</li>
</ul>
<h3>Preparing the virtual machine</h3>
<p>The first step is to create a <a href="http://technet.microsoft.com/en-us/library/cc772480.aspx">new virtual machine</a>
and install the operating system. This should be straight forward but there a few things to look out
for:</p>
<ul>
<li>The operating system must (currently) support <a href="http://en.wikipedia.org/wiki/.NET_Framework_version_history#.NET_Framework_4.5">.NET 4.5</a>
because that is what Sherlock is needs to run on.</li>
<li>The network for the virtual machine must be set up so that it can at the very least see the host
machine and the other virtual machines stored on the same host machine.
<ul>
<li><strong>Note:</strong> Windows networks can <a href="http://www.petri.co.il/working-with-domain-member-virtual-machines-and-snapshots.htm">deny access</a>
to the test virtual machines after being used for a while (usually 30 days) due to the fact that
the test machine is reset after each test, thereby not allowing it to handle the renewal of
network identification keys correctly.</li>
</ul>
</li>
</ul>
<h3>Preparing the operating system</h3>
<p>After the creation of the virtual machine and the installation of the operating system it is necessary
to configure the operating system. Some of the changes are necessary for Sherlock to function while
others are necessary only from a test perspective.</p>
<p>Lets first start with the changes required for Sherlock to function.</p>
<ul>
<li>If .NET 4.5 is not already installed, then install it. Without it Sherlock won't run at all.</li>
<li>Create a new user that will be used to execute the tests. This user needs to be an administrator so
that the execution of an MSI install can succeed without the need for elevation (which is
<a href="http://stackoverflow.com/questions/5098121/how-can-i-get-elevated-permissions-uac-via-impersonation-under-a-non-interacti">a bit tricky</a>
from an application). The user can be either a machine local administrator or a domain user  which
is granted administration rights on the machine.
<ul>
<li>Note that there might a difference between a domain user with administrative rights on the
computer and a local administrator. If you turn UAC off then in general a local administrator
is running all applications elevated while the applications started by the domain user run with
no elevation only to be silently elevated if requested to do so. Unfortunately this means that
the domain user will not be able to run a silent install from a command line unless that command
line is explicitly elevated (which is not possible from an application).</li>
</ul>
</li>
<li>Disable User Access Control (UAC) so that Sherlock can execute MSI installations. <strong>Note:</strong> In some
cases corporate network controls and/or group policies override local settings. In those cases talk
to the local IT people regarding UAC. Also note that on Windows 8 it is not possible to turn off
the UAC by moving the &lsquo;UAC slider&rsquo; all the way down. This is because Metro applications require some
form of UAC to exist in order for them to work.</li>
</ul>
<p>Finally before installing Sherlock a few tweaks should be made to the operating system configuration
so that the automated tests can proceed. Note that for all the following changes there may be group
policies in place put there by your local IT service. It may be necessary to talk to the IT people
about the settings you want to change and the <a href="http://www.brianbondy.com/blog/id/100/">reason</a> you
need to change those settings.</p>
<ul>
<li><strong>Interactive user:</strong> If you need to run interactive tests, e.g. UI tests, then you need to make
sure a user is logged in. Use <a href="http://technet.microsoft.com/en-us/sysinternals/bb963905.aspx">Autologon</a>
to automatically log your user in when the computer starts while still maintaining password security.</li>
<li><strong>Windows 8 switch to desktop:</strong> If you are on Windows 8 you need to make sure that the desktop is
<a href="http://www.7tutorials.com/how-boot-desktop-windows-8-skip-start-screen">available</a> for interactive
applications to execute on.</li>
<li><strong>Screen saver:</strong> In order to prevent any interactive tests from failing due to a
<a href="http://windows.microsoft.com/en-nz/windows-vista/turn-your-screen-saver-on-or-off">screensaver</a> or
the <a href="http://answers.microsoft.com/en-us/windows/forum/windows_7-security/disable-automatic-lock-with-windows-7/daef8f0a-810f-46e8-9420-3c32c4bd6479">automatic locking of the desktop</a>
both those features need to be turned off.</li>
<li><strong>Windows error reporting:</strong> Any tests that run on the desktop may hang eternally if the application
under tests fails and displays the Windows Error Reporting (WER) dialog. In order to prevent this
from happening <a href="http://4sysops.com/archives/how-to-disable-windows-error-reporting/">WER should be disabled</a>.
The most efficient way of doing this is to use the group policy controls to disable the following elements:
<ul>
<li>In <code>Computer Configuration\Administrative Templates\System\Internet Communication Management\Internet Communication settings</code>
enable the setting: <code>Turn off Windows Error Reporting</code>.</li>
<li>In <code>Computer Configuration\Administrative Templates\Windows Components\Windows Error Reporting</code>
enable the settings <code>Disable Windows error reporting</code> and
<code>Prevent display of the user interface for critical errors</code>, and disable the setting
<code>Display error notification</code>.</li>
</ul>
</li>
<li><strong>Automatic updates:</strong> Automatic updates can be disabled because they will never be deployed due
to the fact that the machine is reset after each test.</li>
</ul>
<h3>Configuring Sherlock</h3>
<p>Once the operating system is configured <a href="/projects/sherlock.html">Sherlock</a> can be installed and configured.</p>
<ul>
<li>Unzip the <strong>service.zip</strong> package into the <code>c:\sherlock</code> directory.</li>
<li>Copy the XML file containing the public key used to sign the manifests to the virtual machine and
place it in the <code>c:\sherlock</code> directory.</li>
<li>Open the configuration file (<code>Sherlock.Service.exe.config</code>) and update the following settings:
<ul>
<li><strong>ApplicationName:</strong> The name of the application for which updates should be tracked, in this
case that is: <code>Sherlock.Service.Executor.exe</code>.</li>
<li><strong>UpdateManifestUri:</strong> The URL of the manifest file, in this case: <code>http:\\myhostmachine\appupdate\executorservice.manifest</code></li>
<li><strong>ManifestPublicKeyFile:</strong> The path to the XML file containing the public key section of the
manifest signing key, e.g. <code>C:\sherlock\manifestsigningkey.public.xml</code></li>
</ul>
</li>
<li>Set the update service to start automatically when the computer starts. This can be done as an
actual service (in case no interactive tests will be executed) or by automatically starting the
application when the user logs on to windows (in case interactive tests need to be executed).</li>
<li>The last step is to let the executor controller through the firewall. For this create an inbound
rule that allows <code>c:\ProgramData\Sherlock\Sherlock.Service.Executor\{VERSION}\Sherlock.Service.Executor.exe</code>
to connect to all types of protocols. Normally only Domain and private networks should be sufficient.</li>
</ul>
<h3>Testing</h3>
<p>Once the operating system and Sherlock have been configured it is sensible to test the configurations
to make sure it all works. In order to do this take the following steps:</p>
<ul>
<li>Restart the virtual machine. Once the machine starts up it should (depending on your configuration)
<ul>
<li>Automatically log on the test user</li>
<li>On windows 8 switch to the desktop</li>
<li>Start the Sherlock update service. The service should download the latest version of the executor
controller and start it. You can verify this by looking at the logs which can be found in
<code>c:\programdata\sherlock\sherlock.service\{VERSION}\logs</code> and <code>c:\programdata\sherlock\sherlock.service.executor\{VERSION}\logs</code>
for the update service and the executor controller respectively.</li>
</ul>
</li>
<li>After both applications have started stop them both by stopping the update service (<code>Sherlock.Service</code>).</li>
<li>Once the applications have been stopped remove the data from the directory <code>c:\ProgramData\Sherlock</code>.</li>
<li>Shut down the machine.</li>
<li>Take a <a href="http://blogs.msdn.com/b/virtual_pc_guy/archive/2008/01/16/managing-snapshots-with-hyper-v.aspx">snapshot</a>
of the current state of the virtual machine and give it a sensible name.</li>
</ul>
<h3>Host configuration</h3>
<p>Finally the last step in the configuration of a new test environment is to register the environment
with Sherlock through the management website.</p>

    </div>

    <div id="post-footer">
        <div>
    <div class="navlinks">
                <a href="/posts/Setting-up-Sherlock-serverside" title="Previous Post: Sherlock configuration - Server side" class="navlinks-prev">« Sherlock configuration - Server side</a>
                <a href="/posts/Nuclei-Release-V0710" title="Next Post: Nuclei release - V0.7.1.0" class="navlinks-next">Nuclei release - V0.7.1.0 »</a>
    </div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'mindvortex'; // required: replace example with your forum shortname
    var disqus_identifier = 'Setting-up-Sherlock-virtualmachines';
    var disqus_title = 'Sherlock configuration - Virtual machines';
    var disqus_url = 'https://www.petrikvandervelde.nl/posts/Setting-up-Sherlock-virtualmachines';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
</div>







            </div>
        </div>

        <footer>
            <div id="footer" class="container">
    <div id="fbox1">
        <h2>Related</h2>
        <ul>
            <li id="first"><a href="https://plus.google.com/+PatrickvanderVelde/about"><i class="fa fa-google-plus"></i> Google+</a></li>
            <li><a href="https://github.com/pvandervelde"><i class="fa fa-github"></i> GitHub</a></li>
            <li><a href="http://www.linkedin.com/profile/view?id=33950311"><i class="fa fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="http://stackoverflow.com/users/539846/petrik"><i class="fa fa-stack-overflow"></i> StackOverflow</a></li>
            <li><a href="http://careers.stackoverflow.com/pvandervelde"><i class="fa fa-stack-overflow"></i> StackOverflow Careers</a></li>
            <li><a href="https://twitter.com/petrikvdvelde"><i class="fa fa-twitter"></i> Twitter</a></li>
        </ul>
    </div>
    <div id="fbox2">
        <h2 id="copyright">Copyright</h2>
        <p>Copyright (c) 2017 <a href="/">Petrik van der Velde</a>. All rights reserved.</p>

        <h2 id="disclaimer">Disclaimer</h2>
        <p>The opinions expressed herein are my own personal opinions and do not represent my employer's view in any way.</p>
    </div>
    <div id="fbox3">
        <h2 id="media">Media</h2>
        <p><a href="/feed.atom"><img src="/assets/images/feed.png" alt="Atom feed"></a></p>
    </div>
</div>
<div id="copyright" class="container">
    <p>
        Site design based on the <a href="http://www.freecsstemplates.org/previews/opentools/">Open Tools</a> design
        by <a href="http://www.freecsstemplates.org">FreeCSSTemplates.org</a>.
    </p>
    <p>
        Feed icon by <a href="http://www.icojam.com/">Icojam</a> and Favicon by
        <a href="http://www.flaticon.com/free-icon/twister-sky-wind_12318" title="Yannick">Yannick</a>
        from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>
    </p>
    <p>Generated by <a href="https://wyam.io" rel="nofollow">Wyam</a> on Sat, 14 Jan 2017 11:07:58 GMT.</p>
</div>

        </footer>
    </body>
</html>
